/** Public

const btn = document.querySelector('.btn-country');
const countriesContainer = document.querySelector('.countries');

const renderCountry = function (data, className = '') {
  const html = `
    <article class="country ${className}">
    <img class="country__img" src="${data.flags.svg}" />
    <div class="country__data">
      <h3 class="country__name">${data.altSpellings[1]}</h3>
      <h4 class="country__region">${data.region}</h4>
      <p class="country__row"><span>ğŸ‘«</span>${(
        +data.population / 1000000
      ).toFixed(1)} people</p>
      <p class="country__row"><span>ğŸ—£ï¸</span>${data.languages.por}</p>
      <p class="country__row"><span>ğŸ’°</span>${data.languages.zho}</p>
    </div>
  </article>
    `;
  countriesContainer.insertAdjacentHTML('beforeend', html);
  countriesContainer.style.opacity = 1;
};

const renderError = function (msg) {
  countriesContainer.insertAdjacentText('beforeend', msg);
  countriesContainer.style.opacity = 1;
};

const getPosition = function () {
  return new Promise(function (resolve, reject) {
    // navigator.geolocation.getCurrentPosition(
    //   position => console.log(position),
    //   err => console.error(err)
    // );
    // 1. å¯¼èˆªå™¨åœ°ç†å®šä½ (è·å–å½“å‰ä½ç½®)
    navigator.geolocation.getCurrentPosition(resolve, reject);
  });
};

const getJSON = function (url, errorMsg = 'Something went wrong') {
  return fetch(url).then(response => {
    if (!response.ok) throw new Error(`${errorMsg} (${response.status})`);

    return response.json();
  });
};

 */

/************** å¼‚æ­¥JavaScript */
/*
  1. å¼‚æ­¥JavaScriptçš„ç›®æ ‡, åŸºæœ¬ä¸Šæ˜¯å¤„ç†é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡, åŸºæœ¬åœ¨åå°è¿è¡Œ
  2. å¼‚æ­¥JavaScriptæœ€å¸¸è§çš„ç”¨ä¾‹, æ˜¯ä»è¿œç¨‹æœåŠ¡å™¨è·å–æ•°æ®, åœ¨æ‰€è°“çš„AJAXè°ƒç”¨ä¸­
  3. Promises fetch async awaitå’Œé”™è¯¯å¤„ç†
*/

/************** å¼‚æ­¥JavaScriptã€AJAX å’Œ API */
/* å¼‚æ­¥ä»£ç 1 (æœ‰å›¾)
  1. åå°è¿è¡Œçš„ä»»åŠ¡å®Œæˆåæ‰§è¡Œå¼‚æ­¥ä»£ç 
  2. å¼‚æ­¥ä»£ç æ˜¯éå µå¡çš„
  3. æ‰§è¡Œä¸ç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆå…¶å·¥ä½œ
  4. [1, 2, 3].map(v => v * 2); è¿™æ ·çš„å•ç‹¬çš„å›è°ƒå‡½æ•°ä¸ä¼šä½¿ä»£ç å¼‚æ­¥(å›è°ƒä¸ä¼šè‡ªåŠ¨ä½¿ä»£ç å¼‚æ­¥)
  5. åœ¨ä¸€æ®µæ—¶é—´å†…åè°ƒç¨‹åºçš„è¡Œä¸º
*/

/* å¼‚æ­¥ä»£ç 2 (æœ‰å›¾)
  1.2.3.4 æ¡å®šä¹‰åŒä¸Š
  5. å›è°ƒå‡½æ•°åœ¨å›¾ç‰‡åŠ è½½åæ‰§è¡Œ
  6. addEventListenerä¸ä¼šè‡ªåŠ¨ä½¿ä»£ç å¼‚æ­¥
*/

/* ä»€ä¹ˆæ˜¯ AJAX è°ƒç”¨ï¼Ÿ (æœ‰å›¾)
  1. AJAX = Asynchronous JavaScript and XML (AJAX = å¼‚æ­¥ JavaScript å’Œ XML)
  2. AJAXä¸æ˜¯æ–°çš„ç¼–ç¨‹è¯­è¨€, è€Œæ˜¯ä¸€ç§ä½¿ç”¨ç°æœ‰æ ‡å‡†çš„æ–°æ–¹æ³•, AJAXæ˜¯ä¸€ç§ç”¨äºåˆ›å»ºå¿«é€ŸåŠ¨æ€ç½‘é¡µçš„æŠ€æœ¯
  3. é€šè¿‡åå°ä¸æœåŠ¡å™¨è¿›è¡Œå°‘é‡æ•°æ®äº¤æ¢, AJAXå¯ä»¥ä½¿ç½‘é¡µå®ç°å¼‚æ­¥æ›´æ–°, è¿™æ„å‘³ç€å¯ä»¥ä¸é‡æ–°åŠ è½½æ•´ä¸ªç½‘é¡µçš„æƒ…å†µä¸‹, å¯¹ç½‘é¡µçš„æŸéƒ¨åˆ†è¿›è¡Œæ›´æ–°
  æ€»ç»“ï¼š
  async JavaScript å’Œ xmlï¼šå…è®¸æˆ‘ä»¬ä»¥å¼‚æ­¥æ–¹å¼ä¸è¿œç¨‹webæœåŠ¡å™¨é€šä¿¡, é€šè¿‡ajaxè°ƒç”¨, æˆ‘ä»¬å¯ä»¥åŠ¨æ€åœ°ä»webæœåŠ¡å™¨è¯·æ±‚æ•°æ®
*/

/* ä»€ä¹ˆæ˜¯ APIï¼Ÿ
  1. åº”ç”¨ç¨‹åºæ¥å£ï¼šä¸€ä¸ªè½¯ä»¶, å¯ä»¥è¢«å¦ä¸€ä¸ªè½¯ä»¶ä½¿ç”¨, ä»¥å…è®¸åº”ç”¨ç¨‹åºäº¤è°ˆ
  2. webå¼€å‘ä¸­æœ‰å¾ˆå¤šç±»å‹çš„api(1. DOM API 2. Geolocation(åœ°ç†ä½ç½®) API 3. Own Class API 4. "Online API")
  3. online api: åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åº, å®ƒæ¥æ”¶æ•°æ®è¯·æ±‚, å¹¶å°†æ•°æ®ä½œä¸ºå“åº”å‘å›
  4. æˆ‘ä»¬å¯ä»¥æ„å»ºè‡ªå·±çš„web apis (éœ€è¦åç«¯å¼€å‘, ä¾‹å¦‚ä½¿ç”¨node.js)æˆ–ä½¿ç”¨ 3rd-party APIS
  // å¤©æ°” å›½å®¶ èˆªç­ è´§å¸è½¬æ¢ ç”¨äºå‘é€ç”µå­é‚®ä»¶æˆ–çŸ­ä¿¡çš„ API è°·æ­Œåœ°å›¾ç­‰
*/

// alert('Please Clicked!');
// console.log('loading');
// setTimeout(function () {
//   console.log('Wating 5s');
// }, 5000);

/************** æˆ‘ä»¬ç¬¬ä¸€ä¸ªAJAXè°ƒç”¨ï¼šXMLHttpRequest */

const getCountryDate = function (country) {
  // åˆ›å»ºXMLHttpè¯·æ±‚å¯¹è±¡
  const request = new XMLHttpRequest();
  // è¯·æ±‚æœåŠ¡å™¨æ•°æ®
  request.open('GET', `https://restcountries.com/v2/name/${country}`);
  // æœåŠ¡å™¨å‘é€è¯·æ±‚æ•°æ®
  request.send();

  request.addEventListener('load', function () {
    // è¿”å›çš„å“åº”æ–‡æœ¬
    console.log(this.responseText);
    const [data] = JSON.parse(this.responseText);
    console.log(data);

    const html = `
      <article class="country">
      <img class="country__img" src="${data.flag}" />
      <div class="country__data">
        <h3 class="country__name">${data.name}</h3>
        <h4 class="country__region">${data.region}</h4>
        <p class="country__row"><span>ğŸ‘«</span>${(
          +data.population / 1000000
        ).toFixed(1)} people</p>
        <p class="country__row"><span>ğŸ—£ï¸</span>${data.languages[0].name}</p>
        <p class="country__row"><span>ğŸ’°</span>${
          data.languages[0].currencies
        }</p>
      </div>
    </article>
      `;
    countriesContainer.insertAdjacentHTML('beforeend', html);
    countriesContainer.style.opacity = 1;
  });
};

// getCountryDate('portugal');
// getCountryDate('usa');
/* ä¸ºä»€ä¹ˆè·å–ä¸¤ä¸ªå›½å®¶çš„é¡ºåºä¸ä¸€è‡´ï¼Ÿ
  1. æ¯æ¬¡åŠ è½½é¡µé¢æ—¶, æ•°æ®åˆ°è¾¾çš„æ—¶é—´ç•¥æœ‰ä¸åŒ, è¿™è¡¨æ˜è¡ŒåŠ¨ä¸­çš„éå µå¡è¡Œä¸º, å½“æˆ‘ä»¬ç¬¬ä¸€ä¸ªè°ƒç”¨è‘¡è„ç‰™æ•°æ®æ—¶, å®ƒå‘é€è¿™ä¸ªè¯·æ±‚, ç„¶åJavaScriptç«‹å³åœ¨ä»£ç ä¸­ç§»åŠ¨, å› æ­¤åˆ°ä¸‹ä¸€è¡Œ, è¿™ä¼šè§¦å‘å¦ä¸€ä¸ªAJAXè°ƒç”¨å°±åœ¨è‘¡è„ç‰™ä¹‹å‰
  2. æˆ‘ä»¬å°†æœ‰ä¸¤ä¸ªAJAXè°ƒç”¨åŒæ—¶å‘ç”Ÿ, æ— è®ºè°å…ˆåˆ°, é¦–å…ˆè§¦å‘åŠ è½½äº‹ä»¶, æ‰€ä»¥å¦‚æœç¬¬ä¸€ä¸ªæ—¶AJAXå‘¼å«ç¾å›½, é‚£ä¹ˆç¬¬ä¸€ä¸ªå…ƒç´ ä¼šæ˜¾ç¤ºæ‰“å°æ¥è‡ªç¾å›½,
  3. æˆ‘ä»¬å®é™…ä¸Šä»¥ç›¸åŒçš„é¡ºåºè·å–äº†æ•°æ®, ç°åœ¨å®ƒå®é™…ä¸Šå®Œå…¨ä¸åŒäº†, è¿™è¯å®äº†æˆ‘ä¹‹å‰è§£é‡Šçš„å†…å®¹, ç°åœ¨, å¦‚æœæˆ‘ä»¬çœŸçš„æƒ³è¦æå‡ºè¿™ä¸ªè¯·æ±‚ä»¥ç‰¹å®šçš„æ–¹å¼, æ¯”å¦‚é¢„å®šä¹‰çš„é¡ºåº, æˆ‘ä»¬åŸºæœ¬ä¸Šå¿…é¡»é“¾æ¥è¯·æ±‚, è¿™æ„å‘³æå‡ºç¬¬äºŒä¸ªè¯·æ±‚åªæœ‰åœ¨ç¬¬ä¸€ä¸ªè¯·æ±‚å®Œæˆå
*/

/************** webçš„å·¥ä½œåŸç†ï¼šè¯·æ±‚å’Œå“åº” */
/*
    1. æ¯å½“æˆ‘ä»¬å°è¯•è®¿é—®WebæœåŠ¡å™¨æ—¶, ä½œä¸ºå®¢æˆ·ç«¯çš„æµè§ˆå™¨éƒ½ä¼šå‘æœåŠ¡å™¨å‘é€è¯·æ±‚, ç„¶åæœåŠ¡å™¨å‘å›å“åº”, è¯¥å“åº”åŒ…å«æˆ‘ä»¬è¯·æ±‚çš„æ•°æ®æˆ–ç½‘é¡µ
    2. æ— è®ºæˆ‘ä»¬æ˜¯è®¿é—®æ•´ä¸ªç½‘é¡µè¿˜æ˜¯åªæ˜¯æ¥è‡ªWeb APIçš„ä¸€äº›æ•°æ®, æ­¤è¿‡ç¨‹çš„å·¥ä½œæ–¹å¼éƒ½å®Œå…¨ç›¸åŒ, è¿™æ•´ä¸ªè¿‡ç¨‹å®é™…ä¸Šæœ‰ä¸€ä¸ªåå­—, å®ƒè¢«ç§°ä¸º(è¯·æ±‚-å“åº”æ¨¡å‹æˆ–å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„)
    æ·±å…¥ç ”ç©¶(æµè§ˆå™¨ä¸æœåŠ¡å™¨é€šä¿¡)
      1. åœ¨ä¸Šä¸€ä¸ªè§†é¢‘ä¸­, æˆ‘ä»¬å®é™…è®¿é—®URLçš„ç¤ºä¾‹æ¥è·å–å›½å®¶/åœ°åŒºæ•°æ®, æ¯ä¸ªURLéƒ½ä¼šè·å¾—ä¸€ä¸ªHTTPæˆ–HTTPS, ç”¨äºå°†åœ¨æ­¤è¿æ¥ä¸Šä½¿ç”¨çš„åè®®(ç¨åè®¨è®º)
      2. restcountries.com(åŸŸå)/name/v2(èµ„æº), restcountries.comå®é™…ä¸Šä¸æ˜¯æˆ‘ä»¬è¯•å›¾è®¿é—®çš„æœåŠ¡å™¨çš„çœŸå®åœ°å€, è¿™åªæ˜¯ä¸€ä¸ªå¥½å¬çš„åå­—, æˆ‘ä»¬å®¹æ˜“è®°ä½, è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦ä¸€ç§å°†åŸŸåè½¬æ¢ä¸ºæœåŠ¡å™¨çœŸå®åœ°å€çš„æ–¹æ³•(DNS)
      3. DNSä»£è¡¨åŸŸåæœåŠ¡å™¨, åŸŸåæœåŠ¡å™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„æœåŠ¡å™¨, åŸºæœ¬ä¸Šå°±åƒäº’è”ç½‘çš„ç”µè¯ç°¿, æ‰€ä»¥å½“æˆ‘ä»¬è®¿é—®ä»»ä½•webæœåŠ¡å™¨æ—¶å‘ç”Ÿçš„ç¬¬ä¸€æ­¥æ˜¯æµè§ˆå™¨å‘DNSå‘å‡ºè¯·æ±‚, ç„¶åè¿™ä¸ªç‰¹æ®ŠæœåŠ¡å™¨å°†ç®€å•åœ°å°†URLçš„webåœ°å€ä¸æœåŠ¡å™¨çš„çœŸå®IPåœ°å€è¿›è¡ŒåŒ¹é…, è¿™ä¸€åˆ‡éƒ½æ˜¯é€šè¿‡æ‚¨çš„InternetæœåŠ¡æä¾›å•†è¿›è¡Œçš„, ä½†æ­¤å¤„çš„å®Œæ•´ç»†èŠ‚å¹¶ä¸é‡è¦
      4. æˆ‘ä»¬éœ€è¦ä»ç¬¬ä¸€éƒ¨åˆ†ä¿ç•™çš„æ˜¯, åŸŸä¸æ˜¯çœŸå®åœ°å€,DNSä¼šå°†åŸŸè½¬æ¢ä¸ºçœŸå®IPåœ°å€, ç„¶ååœ¨å°†çœŸå®IPåœ°å€å‘é€å›æµè§ˆå™¨å, æˆ‘ä»¬ç»ˆäºå¯ä»¥è°ƒç”¨å®ƒäº†, æ‰€ä»¥è¿™å°±æ˜¯çœŸå®åœ°å€çš„æ ·å­
      5. å®ƒä»ç„¶æœ‰åè®®, ä½†éšä¹‹è€Œæ¥çš„æ˜¯IPåœ°å€, è¿˜æœ‰æˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸Šè®¿é—®çš„ç«¯å£, è¿™ä¸ªç«¯å£å·å®é™…ä¸Šåªæ˜¯ä¸ºäº†è¯†åˆ«åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œçš„ç‰¹å®šæœåŠ¡, æ‰€ä»¥ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå­åœ°å€, è¿™ä¸ªç«¯å£å·ä¸æˆ‘ä»¬è¦è®¿é—®çš„name/v2èµ„æºæ— å…³, å› æ­¤è¯¥èµ„æºå®é™…ä¸Šå°†åœ¨HTTPè¯·æ±‚ä¸­å‘é€, æˆ‘ä»¬ç¨åä¼šçœ‹åˆ°
      6. ä¸€æ—¦æˆ‘ä»¬æœ‰äº†çœŸå®çš„IPåœ°å€, æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´å°±å»ºç«‹äº†ä¸€ä¸ªTCPå¥—æ¥å­—è¿æ¥, æ‰€ä»¥ä»–ä»¬ç°åœ¨ç»ˆäºè”ç³»ä¸Šäº†, å¹¶ä¸”æ­¤è¿æ¥é€šå¸¸åœ¨ä¼ è¾“ç½‘ç«™çš„æ‰€æœ‰æ–‡ä»¶æˆ–æ‰€æœ‰æ•°æ®æ‰€éœ€çš„æ•´ä¸ªæ—¶é—´å†…ä¿æŒæ´»åŠ¨çŠ¶æ€
    ä»€ä¹ˆæ˜¯TCPå’ŒIPï¼Ÿ
      1. TCPæ˜¯ä¼ è¾“æ§åˆ¶åè®®, IPæ˜¯äº’è”ç½‘åè®®, ä»–ä»¬å…±åŒæ„æˆäº†å‡†ç¡®å®šä¹‰æ•°æ®å¦‚ä½•åœ¨webä¸Šä¼ è¾“çš„é€šä¿¡åè®®,  å®ƒä»¬åŸºæœ¬ä¸Šæ˜¯Internetçš„åŸºæœ¬æ§åˆ¶ç³»ç»Ÿ, å› ä¸ºåŒæ ·å®ƒä»¬åˆ¶å®šæœ‰å…³æ•°æ®å¦‚ä½•åœ¨Internetä¸Šç§»åŠ¨çš„è§„åˆ™çš„äºº(è¿™å¬èµ·æ¥ä»¤äººå›°æƒ‘,è¯·ä¸è¦æ‹…å¿ƒ, åç»­ä¼šæœ‰æ›´å¤šå…³äºTCP/IPçš„çŸ¥è¯†)
      2. æˆ‘ä»¬å‘å‡ºçš„è¯·æ±‚æ˜¯ä¸€ä¸ªHTTPè¯·æ±‚, å…¶ä¸­HTTPä»£è¡¨è¶…æ–‡æœ¬ä¼ è¾“åè®®, æ‰€ä»¥åœ¨TCP/IPä¹‹å, HTTPæ˜¯å¦ä¸€ç§é€šä¿¡åè®®, é€šä¿¡åè®®åªæ˜¯ä¸€ä¸ªå…è®¸ä¸¤æ–¹æˆ–æ›´å¤šæ–¹è¿›è¡Œé€šä¿¡çš„è§„åˆ™ç³»ç»Ÿ, ç°åœ¨å°±HTTPè€Œè¨€, å®ƒåªæ˜¯ä¸€ç§å…è®¸å®¢æˆ·ç«¯å’ŒWebæœåŠ¡å™¨è¿›è¡Œé€šä¿¡çš„åè®®
    HTTPè¯·æ±‚å’Œå“åº”
      ///// å®¢æˆ·ç«¯è¯·æ±‚
      1. è¿™é€šè¿‡ä»å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚å’Œå“åº”æ¶ˆæ¯å¹¶è¿”å›æ¥å·¥ä½œ, æ¶ˆæ¯çš„å¼€å¤´æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†, ç§°ä¸ºèµ·å§‹è¡Œ, è¿™ä¸ªåŒ…å«è¯·æ±‚ä¸­ä½¿ç”¨çš„HTTPæ–¹æ³•, ç„¶åè¯·æ±‚ç›®æ ‡å’ŒHTTPç‰ˆæœ¬
      2. å…³äºHTTPæ–¹æ³•, æœ‰å¾ˆå¤šå¯ç”¨çš„æ–¹æ³•, æœ€é‡è¦çš„æ˜¯(GET, ç®€å•è¯·æ±‚æ•°æ®, POST, å‘é€æ•°æ®, PUTå’ŒPATCH, åŸºæœ¬ä¿®æ”¹æ•°æ®), æ‰€ä»¥ä½ ä¼šçœ‹åˆ°å¯¹æœåŠ¡å™¨çš„HTTPè¯·æ±‚ä¸ä»…æ˜¯ä¸ºäº†è·å–æ•°æ®, è€Œä¸”æˆ‘ä»¬è¿˜å¯ä»¥å‘é€æ•°æ®
      3. ç°åœ¨å…³äºè¯·æ±‚ç›®æ ‡, è¿™æ˜¯æœåŠ¡å™¨è¢«å‘ŠçŸ¥åœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬è¦è®¿é—®name/v2èµ„æºçš„åœ°æ–¹, è¿˜è®°å¾—å—ï¼Ÿæ‰€ä»¥æˆ‘ä»¬ä¹‹å‰åœ¨URLä¸­æœ‰è¿™ä¸ª, ç°åœ¨å®ƒåªæ˜¯ä½œä¸ºHTTPè¯·æ±‚ä¸­çš„ç›®æ ‡å‘é€, ç„¶åæœåŠ¡å™¨å¯ä»¥å¼„æ¸…æ¥šå¦‚ä½•å¤„ç†å®ƒ
      4. å¦‚æœç›®æ ‡æ˜¯ç©ºçš„, æ‰€ä»¥å¦‚æœåªæ˜¯ä¸€ä¸ªæ–œçº¿, é‚£ä¹ˆæˆ‘ä»¬å°†è®¿é—®ç½‘ç«™çš„è·¯ç”±, åœ¨è¿™ä¸ªä¾‹å­ä¸­å°±æ˜¯ restcountries.com ç„¶åè¯·æ±‚çš„ä¸‹ä¸€éƒ¨åˆ†æ˜¯è¯·æ±‚å¤´, å®ƒåªæ˜¯æˆ‘ä»¬å‘é€çš„å…³äºè¯·æ±‚æœ¬èº«çš„ä¸€äº›ä¿¡æ¯, æœ‰å¤§é‡çš„æ ‡å¤´, ä¾‹å¦‚ç”¨äºå‘å‡ºè¯·æ±‚çš„æµè§ˆå™¨ã€æ—¶é—´ã€ç”¨æˆ·çš„è¯­è¨€ç­‰ç­‰
      5. ç°åœ¨ç»ˆäº, åœ¨è¿™ç§æƒ…å†µä¸‹, æˆ‘ä»¬å°†æ•°æ®å‘é€åˆ°æœåŠ¡å™¨, è¿˜æœ‰ä¸€ä¸ªè¯·æ±‚æ­£æ–‡, è¯¥æ­£æ–‡å°†åŒ…å«æˆ‘ä»¬å‘é€çš„æ•°æ®, ä¾‹å¦‚, æ¥è‡ªHTMLè¡¨å•çš„æ•°æ®, è¿™å°±æ˜¯HTTPè¯·æ±‚

      // Httpså’ŒHttpçš„åŒºåˆ«
      6. ä¸æ˜¯æˆ‘ä»¬å¼€å‘äººå‘˜æ‰‹åŠ¨ç¼–å†™è¿™äº›HTTPè¯·æ±‚, ä½†æ˜¯äº†è§£HTTPè¯·æ±‚å’Œå“åº”æ˜¯ä»€ä¹ˆæ ·çš„ä»ç„¶å¾ˆæœ‰å¸®åŠ©å’Œæœ‰ä»·å€¼, å¦å¤–, æˆ‘æƒ³æä¸€ä¸‹, ä½ å¯èƒ½çŸ¥é“è¿˜æœ‰HTTPS, HTTPå’ŒHTTPSä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äº, HTTPSæ˜¯ä½¿ç”¨TLSæˆ–SSLåŠ å¯†çš„, å®ƒä»¬è¿˜æœ‰ä¸€äº›æ˜¯åè®®, ä½†æˆ‘ä¸ä¼šè®©ä½ æ„Ÿåˆ°åŒçƒ¦, ä½†é™¤æ­¤ä¹‹å¤–, HTTPè¯·æ±‚å’Œå“åº”èƒŒåçš„é€»è¾‘ä»ç„¶é€‚ç”¨äºHTTPS


      //// æœåŠ¡å™¨å“åº”
      7. æˆ‘ä»¬è¯·æ±‚å½¢æˆ, ç°åœ¨å®ƒåˆ°è¾¾æœåŠ¡å™¨, ç„¶åæœåŠ¡å™¨å¤„ç†å®ƒ, ç›´åˆ°å®ƒå‡†å¤‡å¥½æˆ‘ä»¬çš„æ•°æ®æˆ–ç½‘é¡µå‘é€å›æ¥, ä¸€æ—¦å‡†å¤‡å°±ç»ª, å®ƒå°†ä½¿ç”¨æ‚¨å¯ä»¥çŒœåˆ°çš„HTTPå“åº”å°†å…¶å‘å›
      8. HTTPå“åº”æ¶ˆæ¯å®é™…ä¸Šçœ‹èµ·æ¥ä¸è¯·æ±‚éå¸¸ç›¸ä¼¼, èµ·å§‹è¡Œã€æ ‡é¢˜å’Œæ­£æ–‡ä¹Ÿæ˜¯å¦‚æ­¤. ç°åœ¨, åœ¨è¿™ç§æƒ…å†µä¸‹, èµ·å§‹è¡Œé™¤äº†ç‰ˆæœ¬ä¹‹å¤–è¿˜æœ‰çŠ¶æ€ä»£ç å’Œæ¶ˆæ¯, è¿™äº›ç”¨äºè®©å®¢æˆ·çŸ¥é“è¯·æ±‚æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥, ä¾‹å¦‚, 200è¡¨ç¤ºå¯ä»¥, 404è¡¨ç¤ºæ‰¾ä¸åˆ°é¡µé¢
      9. å“åº”å¤´æ˜¯å…³äºå“åº”æœ¬èº«çš„ä¿¡æ¯, æ‰€ä»¥å°±åƒä»¥å‰ä¸€æ ·, æœ‰å¾ˆå¤šå¯ç”¨çš„, æˆ‘ä»¬å®é™…ä¸Šå¯ä»¥è‡ªå·±åˆ¶ä½œ, å“åº”çš„æœ€åä¸€éƒ¨åˆ†å†æ¬¡æ˜¯æ­£æ–‡, å®ƒå‡ºç°åœ¨å¤§å¤šæ•°å“åº”ä¸­, è¯¥æ­£æ–‡é€šå¸¸åŒ…å«ä»APIè¿”å›çš„JSONæ•°æ®æˆ–æˆ‘ä»¬è¯·æ±‚çš„ç½‘é¡µçš„HTMLæˆ–ç±»ä¼¼å†…å®¹, æˆ‘ä»¬å¼¹å¾—å¾ˆè¯¦ç»†, å…³äºè¿™é‡Œæœ€é‡è¦çš„éƒ¨åˆ†, å³HTTPè¯·æ±‚å’Œå“åº”

    è·å–jsonæ•°æ®å’Œç½‘é¡µæ•°æ®çš„åŒºåˆ«
      1. åœ¨æˆ‘ä»¬æƒ³è±¡çš„ä¾‹å­ä¸­, æˆ‘ä»¬åªå¯¹restcountries.comåšäº†ä¸€ä¸ªè¯·æ±‚å¹¶å¾—åˆ°äº†ä¸€ä¸ªå›å¤, å¯¹å§ï¼Ÿå½“æˆ‘ä»¬æ‰€ä½œçš„åªæ˜¯è®¿é—®APIæ—¶, è¿™å°±æ˜¯å®ƒçš„å·¥ä½œæ–¹å¼
      2. ä½†æ˜¯å¦‚æœå®ƒæ˜¯æˆ‘ä»¬æ­£åœ¨è®¿é—®çš„ç½‘é¡µ, é‚£ä¹ˆå°†ä¼šæœ‰æ›´å¤šçš„è¯·æ±‚å’Œå“åº”, é‚£æ˜¯å› ä¸ºå½“æˆ‘ä»¬æ‰§è¡Œç¬¬ä¸€ä¸ªè¯·æ±‚æ—¶, æˆ‘ä»¬è¿”å›çš„åªæ˜¯åˆå§‹HTMLæ–‡ä»¶ã€‚
      3. ç„¶å, è¯¥HTMLæ–‡ä»¶è¢«æµè§ˆå™¨æ‰«æä»¥è·å–æ„å»ºæ•´ä¸ªwebé¡µé¢(å¦‚JavaScriptã€CSSæ–‡ä»¶ã€å›¾åƒæ–‡ä»¶æˆ–å…¶ä»–èµ„äº§)æ‰€éœ€çš„æ‰€æœ‰èµ„äº§.
      3. ç„¶åå¯¹äºæ¯ä¸ªä¸åŒçš„æ–‡ä»¶, éƒ½ä¼šå‘æœåŠ¡å™¨å‘å‡ºä¸€ä¸ªæ–°çš„HTTPè¯·æ±‚, æ‰€ä»¥åŸºæœ¬ä¸Šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•´ä¸ªæ¥å›å‘ç”Ÿåœ¨ç½‘é¡µä¸­åŒ…å«çš„æ¯ä¸ªæ–‡ä»¶ä¸­.
      4. å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”, ä½†æ•°é‡ä»ç„¶æœ‰é™, å¦åˆ™è¿æ¥ä¼šå¼€å§‹å˜æ…¢, ä½†æ— è®ºå¦‚ä½•, å½“æˆ‘ä»¬æ‰€æœ‰æ–‡ä»¶æœ€ç»ˆåˆ°è¾¾æ—¶, å°±å¯ä»¥æ ¹æ®æ‚¨å·²ç»çŸ¥é“çš„HTMLã€CSSå’ŒJavaScriptè§„èŒƒåœ¨æµè§ˆå™¨å‘ˆç°webé¡µé¢
    TCP/IPè¿™äº›è¯·æ±‚å’Œå“åº”æ•°æ®å®é™…ä¸Šæ˜¯å¦‚ä½•é€šè¿‡webå‘é€çš„ï¼Ÿ
      1. é¦–å…ˆTCPçš„å·¥ä½œæ˜¯å°†è¯·æ±‚å’Œå“åº”åˆ†è§£æˆæ•°åƒä¸ªå°å—, ç§°ä¸ºæ•°æ®åŒ…, ç„¶åå†å‘é€, ä¸€æ—¦å°æ•°æ®åŒ…åˆ°è¾¾å®ƒä»¬çš„æœ€ç»ˆç›®çš„åœ°, TCPä¼šå°†æ‰€æœ‰æ•°æ®åŒ…é‡æ–°ç»„åˆæˆåŸå§‹è¯·æ±‚æˆ–å“åº”
      2. è¿™æ˜¯å¿…è¦çš„, ä»¥ä¾¿æ¯ä¸ªæ•°æ®åŒ…å¯ä»¥é€šè¿‡äº’è”ç½‘é‡‡ç”¨ä¸åŒçš„è·¯ç”±, å› ä¸ºè¿™æ ·æ¶ˆæ¯å¯ä»¥å°½å¿«åˆ°è¾¾ç›®çš„åœ°, å¦‚æœæˆ‘ä»¬å°†æ•´ä¸ªæ•°æ®ä½œä¸ºä¸€ä¸ªå¤§å—å‘é€, è¿™æ˜¯ä¸å¯èƒ½çš„
      3. è¿™å°±åƒè¯•å›¾ç”¨ä½ èƒ½æƒ³è±¡çš„æœ€å¤§çš„å…¬å…±æ±½è½¦ä¸€æ ·ç©¿è¿‡å¯†é›†çš„äº¤é€š, æ‰€ä»¥å¯èƒ½ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„, ç°åœ¨, ä½œä¸ºç¬¬äºŒéƒ¨åˆ†, IPåè®®çš„å·¥ä½œæ˜¯é€šè¿‡Internetå®é™…å‘é€å’Œè·¯ç”±è¿™äº›æ•°æ®åŒ…, å› æ­¤, å®ƒç¡®ä¿ä»–ä»¬åº”è¯¥å»çš„ç›®çš„åœ°, ä½¿ç”¨æ¯ä¸ªæ•°æ®åŒ…çš„IPåœ°å€, è¿™å°±æ˜¯webå¹•åå‘ç”Ÿçš„äº‹æƒ…çš„å¹¿æ³›æ¦‚è¿°, è®©æˆ‘ä»¬å›åˆ°JavaScriptå’ŒAJAXè°ƒç”¨
*/

/************** æ¬¢è¿å›åˆ°å›è°ƒåœ°ç‹± callback hell(åŒä¸Š) */
/*
  1. å½“æˆ‘ä»¬å¼‚æ­¥è°ƒç”¨æ•°æ®, è°ƒç”¨å†…å®¹é¡ºåºä¼šä¸åŒ, å› ä¸ºå¼‚æ­¥JavaScriptæ˜¯ä¸å µå¡çš„, ç¬¬äºŒä¸ªå¼‚æ­¥è°ƒç”¨å¯èƒ½ä¼šæå‰å®Œæˆ
  2. å›è°ƒåœ°ç‹±æ˜¯å½“æˆ‘ä»¬æœ‰å¾ˆå¤šåµŒå¥—å›è°ƒæ—¶, ä»¥ä¾¿æŒ‰é¡ºåºæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡
  3. å›è°ƒåœ°ç‹±çš„æ–¹å¼è®©æˆ‘ä»¬çš„ä»£ç çœ‹èµ·æ¥å¾ˆå¤š, éš¾ä»¥ç»´æŠ¤
  4. ES6ä¹‹å, å®é™…ä¸Šæœ‰ä¸€ç§é€ƒé¿å›è°ƒåœ°ç‹±çš„æ–¹æ³•, é€šè¿‡ä½¿ç”¨ä¸€ç§å«åšæ‰¿è¯ºçš„ä¸œè¥¿
*/
/*
  
*/

const getCountryAndNeighbour = function (country) {
  // AJAX call country 1
  const request = new XMLHttpRequest();
  request.open('GET', `https://restcountries.com/v2/name/${country}`);
  request.send();
  // 1. ç¬¬ä¸€æ¬¡æ‰§è¡Œå¼‚æ­¥å‡½æ•°
  request.addEventListener('load', function () {
    const [data] = JSON.parse(this.responseText);
    console.log(data);
    // AJAX render country 1
    renderCountry(data);

    // Get neighbour country (2)
    const [neighbour] = data.borders;
    if (!neighbour) return;

    // AJAX call country 2
    const request2 = new XMLHttpRequest();
    request2.open('GET', `https://restcountries.com/v2/alpha/${neighbour}`);
    request2.send();
    // 2. ç¬¬äºŒæ¬¡æ‰§è¡Œå¼‚æ­¥å‡½æ•°
    request2.addEventListener('load', function () {
      const data2 = JSON.parse(this.responseText);
      console.log(data2);

      renderCountry(data2, 'neighbour');
    });
  });
};

getCountryAndNeighbour('portugal');

/************** Promises å’Œ Fetch API */
/*
  1. æ‰€ä»¥æˆ‘ä»¬ä¸è¦æ›¿æ¢æ—§çš„ XML HTTP è¯·æ±‚å‡½æ•°, ä»¥ç°ä»£æ–¹å¼è¿›è¡ŒAJAXè°ƒç”¨, é‚£å°±æ˜¯ä½¿ç”¨ Fetch API
  2. Fetch API å‘å‡ºç®€å•çš„getè¯·æ±‚, çœŸæ­£éœ€è¦çš„åªæ˜¯ä¼ å…¥URL, å¯¹äºæ›´å¤æ‚çš„AJAXè°ƒç”¨, fetchå‡½æ•°å¯ä»¥å‘å¯¹è±¡ä¸€æ ·æ¥å—é€‰é¡¹ 
  3. fetchå‡½æ•°è¿”å›ä¸€ä¸ªæ‰¿è¯º, å¦‚æœè¿”å›çš„æ‰¿è¯ºæ˜¯resolve, then()åˆ™æ‰§è¡Œæ–¹æ³•ä¸­çš„å‡½æ•°, å¤„ç†APIæ¥æ”¶åˆ°çš„æ•°æ®åœ¨å‡½æ•°ä¸­
*/

const request = new XMLHttpRequest();
request.open('GET', `https://restcountries.com/v2/name/${country}`);
request.send();

const request = fetch('https://restcountries.com/v2/name/portugal');
console.log(request); // Promises Response å›å¤

/* (æœ‰å›¾)
  ä»€ä¹ˆæ˜¯æ‰¿è¯ºï¼Ÿ
    1. Promise: ç”¨ä½œå¼‚æ­¥æ“ä½œçš„æœªæ¥ç»“æœçš„å ä½ç¬¦å¯¹è±¡
    2. Promiseï¼šå¼‚æ­¥ä¼ é€’å€¼çš„å®¹å™¨
    3. æ‰¿è¯ºï¼šæœªæ¥ä»·å€¼çš„å®¹å™¨ (ç¤ºä¾‹ï¼šæ¥è‡ªAJAXè°ƒç”¨çš„å“åº”)
  Promiseæ˜¯ES6çš„æ–°ç‰¹æ€§, å®ƒæœ€å¤§çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ
    æˆ‘ä»¬ä¸éœ€è¦ä¾èµ–ç»™å¼‚æ­¥å‡½æ•°çš„äº‹ä»¶å’Œå›è°ƒæ¥å¤„ç†å¼‚æ­¥ç»“æœ, ä»£æ›¿åµŒå¥—å›è°ƒ, æˆ‘ä»¬å¯ä»¥å°†promiseé“¾æ¥åˆ°ä¸€ä¸ªå¼‚æ­¥æ“ä½œåºåˆ—ï¼šè½¬ä¹‰å›è°ƒåœ°ç‹±
  æ‰¿è¯ºæ‰§è¡Œè¿‡ç¨‹
    1. ç­”åº”æˆ‘å¦‚æœæˆ‘æ‰å¯¹äº†ç»“æœå°±æ”¶é’±
    2. æˆ‘ç°åœ¨ä¹°å½©ç¥¨(æ‰¿è¯º)
    3. æŠ½å¥–æ˜¯å¼‚æ­¥å‘ç”Ÿçš„
    4. å¦‚æœç»“æœæ­£ç¡®, æˆ‘ä¼šæ”¶åˆ°é’±, å› ä¸ºè¿™æ˜¯æ‰¿è¯ºçš„
*/

/* æ‰¿è¯ºçš„åŸºæœ¬æ¦‚å¿µ
  1. æ‰€ä»¥ä¸€å¼€å§‹, æˆ‘ä»¬è¯´æ‰¿è¯ºæ˜¯æœªå†³çš„, æ‰€ä»¥è¿™æ˜¯åœ¨ä»»ä½•ç”±å¼‚æ­¥ä»»åŠ¡å¯ç”¨, ç°åœ¨, åœ¨è¿™æ®µæ—¶é—´é‡Œ, å¼‚æ­¥ä»»åŠ¡ä»åœ¨åšå®ƒçš„å·¥ä½œåœ¨åå°, å¯ç„¶åå½“ä»»åŠ¡æœ€ç»ˆå®Œæˆæ—¶, æˆ‘ä»¬è¯´æ‰¿è¯ºå·²ç»è§£å†³äº†, æ˜¯ä¸¤ç§ä¸åŒç±»å‹çš„å·²è§£å†³æ‰¿è¯ºå’Œé‚£æ˜¯å…‘ç°çš„æ‰¿è¯ºå’Œæ‹’ç»çš„æ‰¿è¯º
  2. æ‰€ä»¥ä¸€ä¸ªå®ç°çš„æ‰¿è¯ºæ˜¯ä¸€ä¸ªæ‰¿è¯º, æˆåŠŸåœ°äº§ç”Ÿäº†æˆ‘ä»¬æœŸæœ›çš„å€¼, ä¾‹å¦‚, å½“æˆ‘ä»¬ä½¿ç”¨Promiseæ¥è·å–æ•°æ®æ—¶, æ¥è‡ªAPI, ä¸€ä¸ªå…‘ç°çš„æ‰¿è¯ºæˆåŠŸåœ°æ‘§æ¯äº†è¿™äº›æ•°æ®, ç°åœ¨å¯ä»¥ä½¿ç”¨äº†, å¦ä¸€æ–¹é¢, è¢«æ‹’ç»çš„æ‰¿è¯ºæ„å‘³ç€å¼‚æ­¥ä»»åŠ¡æœŸé—´å‡ºç°é”™è¯¯, ä»¥åŠä»APIè·å–æ•°æ®çš„ç¤ºä¾‹, å½“ç”¨æˆ·ç¦»çº¿ä¸”æ— æ³•è¿æ¥åˆ°APIæœåŠ¡å™¨æ—¶
  3. ç°åœ¨å›åˆ°æˆ‘ä»¬çš„å½©ç¥¨ç±»æ¯”, æŠ½å¥–åŸºæœ¬ä¸Šå¼‚æ­¥ä»»åŠ¡, è¿™å†³å®šäº†ç»“æœ, ä¸€æ—¦ç»“æœå¯ç”¨, ç¥¨å°±ä¼šè¢«ç»“ç®—
  4. å¦‚æœæˆ‘ä»¬çŒœå¯¹äº†ç»“æœ, å½©ç¥¨å°†å…‘ç°æˆ‘ä»¬å¾—åˆ°æˆ‘ä»¬çš„é’±, ç„¶è€Œå¦‚æœæˆ‘ä»¬çŒœé”™äº†, ç„¶åç¥¨åŸºæœ¬ä¸Šè¢«æ‹’ç»äº†, è€Œæˆ‘ä»¬æ‰€ä½œçš„åªæ˜¯æµªè´¹æˆ‘ä»¬çš„é’±, ç°åœ¨è¿™äº›ä¸åŒçš„çŠ¶æ€, ç†è§£è¿™ä¸€ç‚¹éå¸¸é‡è¦, å› ä¸ºå½“ä»£ç ä¸­ä½¿ç”¨Promiseæ—¶, æˆ‘ä»¬å°†èƒ½å¤Ÿå¤„ç†è¿™äº›ä¸åŒçš„çŠ¶æ€ç»“æœåšæŸäº‹
  5. Promisesæ—¶ä¸€ä¸ªæ‰¿è¯ºåªè§£å†³ä¸€æ¬¡, æ‰€ä»¥ä»é‚£é‡Œå¼€å§‹, å›½å®¶å°†æ°¸è¿œä¿æŒä¸å˜, æ‰€ä»¥æ‰¿è¯ºè¦ä¹ˆè¢«å®ç°, è¦ä¹ˆè¢«æ‹’ç», ä½†æ”¹å˜è¿™ç§çŠ¶æ€æ˜¯ä¸å¯èƒ½çš„, ç°åœ¨, æˆ‘åœ¨è¿™é‡Œå‘ä½ å±•ç¤ºçš„è¿™äº›ä¸åŒçš„çŠ¶æ€
  6. å½“æˆ‘ä»¬ä½¿ç”¨æ‰¿è¯ºæ—¶æ˜¯ç›¸å…³ä¸”æœ‰ç”¨çš„å¾—åˆ°ç»“æœ, è¿™è¢«ç§°ä¸ºæ¶ˆè´¹æ‰¿è¯º, æ‰€ä»¥æˆ‘ä»¬æ¶ˆè´¹äº†ä¸€ä¸ªæ‰¿è¯º, ä¾‹å¦‚ï¼šå½“æˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªæ‰¿è¯ºæ—¶, è¢«é€€å›çš„æ‰¿è¯ºä»fetchå‡½æ•°, å°±åœ¨è¿™ä¸ªè§†é¢‘çš„å¼€å¤´
  7. è®°ä½, ä½†æ˜¯ä¸ºäº†è®©æ‰¿è¯ºé¦–å…ˆå­˜åœ¨, å®ƒå¿…é¡»é¦–å…ˆè¢«å»ºé€ , æ‰€ä»¥å¿…é¡»åœ¨fetch APIçš„æƒ…å†µä¸‹åˆ›å»º, å®ƒæ˜¯æ„å»ºæ‰¿è¯ºçš„fetchå‡½æ•°, å¹¶è¿”å›ç»™æˆ‘ä»¬æ¶ˆè´¹, æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹, æˆ‘ä»¬ä¸å¿…è‡ªå·±å»ºç«‹æ‰¿è¯ºä¸ºäº†æ¶ˆè€—å®ƒ, ç°åœ¨, å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬å®é™…ä¸Šä¼šåªæ¶ˆè´¹æ‰¿è¯º, è¿™ä¹Ÿæ˜¯æ›´å®¹æ˜“å’Œæ›´æœ‰ç”¨çš„éƒ¨åˆ†, ä½†æœ‰æ—¶æˆ‘ä»¬ä¹Ÿéœ€è¦å»ºç«‹ä¸€ä¸ªæ‰¿è¯ºå’Œä¸åªæ˜¯æ¶ˆè´¹å®ƒ
 */

/* Promise APIæå‡ºä»¥ä¸‹å»ºè®®ï¼š
  1. æ¯ä¸ªå¼‚æ­¥ä»»åŠ¡å°†è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡
  2. æ¯ä¸ªPromiseå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªthenå‡½æ•°, å¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•°, ä¸€ä¸ªsuccesså¤„ç†ç¨‹åºå’Œä¸€ä¸ªerrorå¤„ç†ç¨‹åº
  3. å¼‚æ­¥ä»»åŠ¡å®Œæˆå, å‡½æ•°ä¸­çš„æˆåŠŸæˆ–é”™è¯¯å¤„ç†ç¨‹åºthenåªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡
  4. è¯¥thenå‡½æ•°ä¹Ÿå°†è¿”å›ä¸€ä¸ªPromise, ä»¥å…è®¸é“¾æ¥å¤šä¸ªè°ƒç”¨
  5. æ¯ä¸ªå¤„ç†ç¨‹åº(æˆåŠŸæˆ–é”™è¯¯)éƒ½å¯ä»¥è¿”å›ä¸€ä¸ªvalue, å®ƒå°†argumentåœ¨promiseé“¾ä¸­ä½œä¸ºä¸€ä¸ªä¼ é€’ç»™ä¸‹ä¸€ä¸ªå‡½æ•°
  6. å¦‚æœä¸€ä¸ªå¤„ç†ç¨‹åºè¿”å›ä¸€ä¸ªpromise(å‘å‡ºå¦ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚), åˆ™åªæœ‰åœ¨è¯·æ±‚å®Œæˆåæ‰ä¼šè°ƒç”¨ä¸‹ä¸€ä¸ªå¤„ç†ç¨‹åº(æˆåŠŸæˆ–é”™è¯¯)
*/

/************** æ¶ˆè´¹æ‰¿è¯º */

const getCountryData = function (country) {
  fetch(`https://restcountries.com/v2/name/${country}`)
    .then(function (response) {
      console.log(response);
      return response.json();
    })
    .then(function (data) {
      console.log(data);
      renderCountry(data[0]);
      const neighbour = data[0].borders[0];
      if (!neighbour) return;
      return fetch(`https://restcountries.com/v2/alpha/${neighbour}`);
    })
    .then(response => response.json())
    .then(data => renderCountry(data, 'neighbour'));
};

getCountryData('portugal');

/* json()è§£ææ–¹æ³•å®é™…ä¹Ÿæ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°, å¹¶ä¸”è¿”å›ä¸€ä¸ªæ–°çš„æ‰¿è¯º
  1. æˆ‘ä»¬éœ€è¦åœ¨å“åº”ä¸Šè°ƒç”¨jsonæ–¹æ³•, å¥½çš„, æ‰€ä»¥jsonæ˜¯ä¸€ä¸ªå¯ç”¨çš„æ–¹æ³•, åœ¨fetchæ–¹æ³•çš„æ‰€æœ‰å“åº”ä¸Š, jsonsæ˜¯ä¸€ç§å¯ç”¨çš„æ–¹æ³•, åœ¨æ‰€æœ‰å³å°†åˆ°æ¥çš„å“åº”å¯¹è±¡ä¸Š
  2. å®é™…ä¸Š, è¿™é‡Œçš„å“åº”å®é™…ä¸Šæ˜¯ä¸€ä¸ªå·²è§£å†³çš„å€¼, å› æ­¤å®ƒç¡®å®æœ‰é™„åŠ åˆ°å®ƒçš„jsonæ–¹æ³•, è¿™é‡Œçš„é—®é¢˜æ˜¯è¿™ä¸ªjsonå‡½æ•°æœ¬èº«, å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°, è¿™æ„å‘³ç€ä»€ä¹ˆ, æ˜¯å®ƒä¹Ÿä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ‰¿è¯º, è¿™æœ‰ç‚¹ä»¤äººå›°æƒ‘, ä½†è¿™å°±æ˜¯å®ƒçš„å·¥ä½œåŸç†
*/

/************** å¤„ç†è¢«æ‹’ç»çš„æ‰¿è¯º(v2 æ”¹ä¸º v3è§£å†³å“åº”ä¸€ç›´è¿”å›trueçš„é—®é¢˜) */
/*
  1. .then(err => alert(err)) åœ¨å›è°ƒä¸­æ‰“å°é”™è¯¯ 
  2. .catch() åœ¨å…¨çƒèŒƒå›´å†…å¤„ç†é”™è¯¯
  3. .finally()æ— è®ºæ‰¿è¯ºå‘ç”Ÿä»€ä¹ˆ, éƒ½å°†å§‹ç»ˆè¢«è°ƒç”¨, æ— è®ºæ‰¿è¯ºå…‘ç°è¿˜æ˜¯è¢«æ‹’ç», æˆ‘ä»¬å®šä¹‰çš„å›è°ƒéƒ½ä¼šè¢«è°ƒç”¨
    a) åŠ è½½å¾®è°ƒå™¨, å°±åƒä½ éšå¤„å¯è§çš„è¿™äº›æ—‹è½¬çš„åœ†åœˆ, åœ¨webåº”ç”¨ç¨‹åºç§åŠ è½½æŸäº›æ•°æ®æ—¶
    b) åº”ç”¨ç¨‹åºæ˜¾ç¤ºäº†ä¸€ä¸ªå¾®è°ƒå™¨, å½“å¼‚æ­¥æ“ä½œå¼€å§‹æ—¶, ç„¶ååœ¨æ“ä½œå®Œæˆåéšè—å®ƒ
    c) æ— è®ºå¦‚ä½•, è¿™éƒ½ä¼šå‘ç”Ÿæ“ä½œæˆåŠŸä¸å¦, å› æ­¤è¿™ä¸ªæ–¹æ³•æ˜¯å®Œç¾çš„
  4. erræ˜¯ä¸€ä¸ªJavaScriptå¯¹è±¡, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°åœ¨JavaScriptç§åˆ›å»ºé”™è¯¯, å°±åƒmapå’Œset
*/

const getCountryData = function (country) {
  fetch(`https://restcountries.com/v3/name/${countrys}`)
    .then(response => {
      console.log(response);
      /*
          body: ï¼ˆâ€¦ï¼‰
          bodyUsed: true
          headers: Headers {}
          ok: true
          redirected: false
          status: 200
          statusText: "OK"
          type: "cors"
          url: "https://restcountries.com/v3/name/portugal"
          [[Prototype]]: Response
        */
      if (!response.ok)
        // æ‹’ç»å“åº”ä¿¡æ¯æ—¶, æ‰‹åŠ¨æŠ›å‡ºä¸€ä¸ªé”™è¯¯å¯¹è±¡
        throw new Error(`Country not found (${response.status})`);
      return response.json();
    })
    .then(data => {
      console.log(data);

      /*
          {status: 404, message: 'Not Found'}
          message: "Not Found"
          status: 404
          [[Prototype]]: Object
        */
      renderCountry(data[0]);
      const neighbour = data[0].borders[0];
      if (!neighbour) return;

      return fetch(`https://restcountries.com/v2/alpha/${neighbour}`);
    })
    .then(response => response.json())
    .then(data => renderCountry(data, 'neighbour'))
    .catch(err => {
      // Country not found (404) ğŸ˜ğŸ˜ğŸ˜
      console.error(`${err} ğŸ˜ğŸ˜ğŸ˜`);
      renderError(`Somethins went wrong ğŸ˜ğŸ˜ ${err.message}. Try again!`);
    })
    .finally(() => {
      countriesContainer.style.opacity = 1;
    });
};
btn.addEventListener('click', function () {
  getCountryData('portugalasdasda');
});

/************** æ‰‹åŠ¨æŠ›å‡ºé”™è¯¯ */
/*
  1. æ£€æŸ¥å †æ ˆè¿½è¸ª, æ²¡æœ‰ååº”çœŸæ­£çš„é”™è¯¯, è¿™å°±æ˜¯æˆ‘ä»¬çš„API, çœŸæ­£çš„é”™è¯¯å½“ç„¶ä¸æ˜¯æˆ‘ä»¬æ— æ³•è¯»å–æœªå®šä¹‰çš„æ ‡å¿—, 404çŠ¶æ€ç 
  2. fetchå‡½æ•°åªæ‹’ç»å½“æ²¡æœ‰äº’è”ç½‘è¿æ¥æ—¶, åƒè¿™æ ·404çš„é”™è¯¯ä¸æ˜¯çœŸæ­£çš„é”™è¯¯, è·å–æ‰¿è¯ºä»ç„¶ä¼šå¾—åˆ°æ»¡è¶³, æ‰€ä»¥æ²¡æœ‰æ‹’ç», å› æ­¤æˆ‘ä»¬æ— æ³•æ•è·ç¨‹åºä¸­çœŸæ­£çš„é”™è¯¯, è¿™æ ·æˆ‘ä»¬ä¼šè¿”å›å¾ˆå¤šé”™è¯¯, ä½†ä¸çŸ¥é“ç©¶ç«Ÿæ˜¯å“ªé‡Œå…ˆå‡ºç°äº†é—®é¢˜(é‡ç‚¹)
  3. fetchå‡½æ•°ä»ç„¶æ²¡æœ‰æ‹’ç», é¡ºä¾¿è¯´ä¸€ä¸‹, å¾ˆå¤šäººåŒ…æ‹¬æˆ‘è‡ªå·±è®¤ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹, å®é™…ä¸Šåº”è¯¥ç«‹å³æ‹’ç»æ‰¿è¯º, å› ä¸ºåœ¨è¿™ä¸ªå›è°ƒä¸­æŠ›å‡ºä¸€ä¸ªé”™è¯¯, è¿™ä¸ªthenæ–¹æ³•å°†ç«‹å³æ‹’ç»è¿™ä¸ªæ‰¿è¯º, ç„¶åé‚£ä¸ªè¢«æ‹’ç»çš„æ‰¿è¯ºä¼šä¼ æ’­ä¸‹å», çŸ¥é“å®ƒæœ€ç»ˆåœ¨æŸä¸ªåœ°æ–¹è¢«æŠ“ä½, è¿™ç§æƒ…å†µä¸‹, å®ƒå°±åœ¨è¿™é‡Œ, åœ¨è¿™ä¸ªcatchå¤„ç†ç¨‹åºä¸­
*/

const getCountryData = function (country) {
  // Country 1
  getJSON(`https://restcountries.com/v3/name/${country}`, 'Country not found')
    .then(data => {
      console.log(data);
      renderCountry(data[0]);
      const neighbour = data[0].borders[0];

      if (!neighbour) throw new Error('No neighbour found!');

      // Country 2
      return getJSON(
        `https://restcountries.com/v3/alpha/${neighbour}`,
        'Country not found'
      );
    })

    .then(data => renderCountry(data, 'neighbour'))
    .catch(err => {
      console.error(`${err} ğŸ’¥ğŸ’¥ğŸ’¥`);
      renderError(`Something went wrong ğŸ’¥ğŸ’¥ ${err.message}. Try again!`);
    })
    .finally(() => {
      countriesContainer.style.opacity = 1;
    });
};

btn.addEventListener('click', function () {
  getCountryData('portugalsda');
});

getCountryData('australia');

/************** ç¼–ç æŒ‘æˆ˜ #1  Coding Challenge #1 */
/*
  åœ¨è¿™ä¸ªæŒ‘æˆ˜ä¸­ï¼Œæ‚¨å°†æ„å»ºä¸€ä¸ªå‡½æ•°â€œwhereAmIâ€ï¼Œå®ƒä»…æ ¹æ® GPS åæ ‡å‘ˆç°ä¸€ä¸ªå›½å®¶/åœ°åŒºã€‚ä¸ºæ­¤ï¼Œæ‚¨å°†ä½¿ç”¨ç¬¬äºŒä¸ª API å¯¹åæ ‡è¿›è¡Œåœ°ç†ç¼–ç ã€‚

  ä»¥ä¸‹æ˜¯æ‚¨çš„ä»»åŠ¡ï¼š

  ç¬¬1éƒ¨åˆ†
  1. åˆ›å»ºä¸€ä¸ªå‡½æ•°â€œwhereAmIâ€ï¼Œå®ƒå°†çº¬åº¦å€¼ (lat) å’Œç»åº¦å€¼ (lng) ä½œä¸ºè¾“å…¥ï¼ˆè¿™äº›æ˜¯ GPS åæ ‡ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼‰ã€‚
  2. å¯¹æä¾›çš„åæ ‡è¿›è¡Œâ€œåå‘åœ°ç†ç¼–ç â€ã€‚åå‘åœ°ç†ç¼–ç æ„å‘³ç€å°†åæ ‡è½¬æ¢ä¸ºæœ‰æ„ä¹‰çš„ä½ç½®ï¼Œä¾‹å¦‚åŸå¸‚å’Œå›½å®¶/åœ°åŒºåç§°ã€‚ä½¿ç”¨æ­¤ API è¿›è¡Œåå‘åœ°ç†ç¼–ç ï¼šhttps://geocode.xyz/apiã€‚
  AJAX è°ƒç”¨å°†ä½¿ç”¨ä»¥ä¸‹æ ¼å¼å¯¹ URL è¿›è¡Œï¼šhttps://geocode.xyz/52.508,13.381?geoit=jsonã€‚ä½¿ç”¨ fetch API å’Œ promise æ¥è·å–æ•°æ®ã€‚ä¸è¦ä½¿ç”¨æˆ‘ä»¬åˆ›å»ºçš„ getJSON å‡½æ•°ï¼Œè¿™æ˜¯ä½œå¼Š ğŸ˜‰
  3. è·å¾—æ•°æ®åï¼Œåœ¨æ§åˆ¶å°ä¸­æŸ¥çœ‹å®ƒä»¥æŸ¥çœ‹æ‚¨æ”¶åˆ°çš„æœ‰å…³æ‰€æä¾›ä½ç½®çš„æ‰€æœ‰å±æ€§ã€‚ç„¶åï¼Œä½¿ç”¨è¿™äº›æ•°æ®ï¼Œå°†è¿™æ ·çš„æ¶ˆæ¯è®°å½•åˆ°æ§åˆ¶å°ï¼šâ€œä½ åœ¨å¾·å›½æŸæ—â€
  4. å°† .catch æ–¹æ³•é“¾æ¥åˆ° promise é“¾çš„æœ«å°¾å¹¶å°†é”™è¯¯è®°å½•åˆ°æ§åˆ¶å°
  5. æ­¤ API å…è®¸æ‚¨æ¯ç§’ä»…å‘å‡º 3 ä¸ªè¯·æ±‚ã€‚å¦‚æœæ‚¨å¿«é€Ÿé‡æ–°åŠ è½½ï¼Œæ‚¨å°†æ”¶åˆ°ä»£ç  403 çš„æ­¤é”™è¯¯ã€‚è¿™æ˜¯è¯·æ±‚çš„é”™è¯¯ã€‚è¯·è®°ä½ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ fetch() ä¸ä¼šæ‹’ç»æ‰¿è¯ºã€‚å› æ­¤ï¼Œåˆ›å»ºä¸€ä¸ªé”™è¯¯ä»¥æ‹’ç»æ‰¿è¯ºï¼Œå¹¶æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯ã€‚

  ç¬¬2éƒ¨åˆ†
  6. ç°åœ¨æ˜¯æ—¶å€™ä½¿ç”¨æ¥æ”¶åˆ°çš„æ•°æ®æ¥æ¸²æŸ“ä¸€ä¸ªå›½å®¶äº†ã€‚æ‰€ä»¥ä»åœ°ç†ç¼–ç  API ç»“æœä¸­å–å‡ºç›¸å…³å±æ€§ï¼Œå°†å…¶æ’å…¥åˆ°æˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨çš„å›½å®¶/åœ°åŒº API ä¸­ã€‚
  7.æ¸²æŸ“å›½å®¶å¹¶æ•æ‰ä»»ä½•é”™è¯¯ï¼Œå°±åƒæˆ‘ä»¬åœ¨ä¸Šä¸€è¯¾ä¸­æ‰€åšçš„ä¸€æ ·ï¼ˆæ‚¨ç”šè‡³å¯ä»¥å¤åˆ¶æ­¤ä»£ç ï¼Œæ— éœ€é”®å…¥ç›¸åŒçš„ä»£ç ï¼‰

  æµ‹è¯•åæ ‡ 1ï¼š52.508ã€13.381ï¼ˆçº¬åº¦ã€ç»åº¦ï¼‰
  æµ‹è¯•åæ ‡ 2: 19.037, 72.873
  æµ‹è¯•åæ ‡ 2ï¼š-33.933ã€18.474

  ç¥ä½ å¥½è¿ğŸ˜€
*/
const whereAmI = function (lat, lng) {
  fetch(`https://geocode.xyz/${lat},${lng}?geoit=json`)
    .then(res => res.json())
    .then(data => {
      console.log(data);
      console.log(`You are in ${data.city}, ${data.country}`);

      return fetch(`https://restcountries.com/v2/name/${data.country}`);
    })
    .then(res => {
      // æ‰‹åŠ¨æŠ›å‡ºé”™è¯¯ä¿¡æ¯, å¹¶å‘ä¸‹ä¼ é€’åˆ°catchæ–¹æ³•
      if (!res.ok) throw new Error(`Country not found (${res.status})`);
      return res.json();
    })
    .then(data => renderCountry(data[0]))
    .catch(err => {
      console.log(err);
      console.error(`${err.message} ğŸ’¥ `);
    });
};

whereAmI(52.508, 13.381);
whereAmI(19.037, 72.873);
whereAmI(-33.933, 18.474);

/************** å¹•åå¼‚æ­¥ï¼šäº‹ä»¶å¾ªç¯ (Behind the scenes asynchrony: the event loop) */
/*
  å‰è¨€
    æˆ‘ä»¬äº†è§£äº†AJAX å’Œ API æ˜¯ä»€ä¹ˆ, æˆ‘ä»¬å·²ç»ä½¿ç”¨äº†ä¸€å †å¼‚æ­¥ä»£ç , æˆ‘ä»¬å­¦ä¹ äº†æ‰€æœ‰å…³äºæ‰¿è¯ºçš„çŸ¥è¯†, ä½†ç¼ºå°‘çš„æ˜¯æœ€ç»ˆäº†è§£æ‰€æœ‰å®ƒç¡®å®åœ¨JavaScriptçš„å¹•åå·¥ä½œ, æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹, é¦–å…ˆæˆ‘ä»¬å¿«é€Ÿå›é¡¾ä¸€ä¸‹JavaScriptè¿è¡Œæ—¶, æˆ‘ä»¬è¯¾å ‚ä¸­è°ˆåˆ°çš„æ–¹å¼, åªæ˜¯ä¸ºäº†ç¡®ä¿æœ¬è®²åº§çš„å…¶ä½™éƒ¨åˆ†å°†ä½¿æ„Ÿè§‰ä½ , å› æ­¤, 
  å¹•åå¼‚æ­¥æ¶‰åŠå†…å®¹ä»‹ç»
    1. JavaScriptè¿è¡Œæ—¶åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªå®¹å™¨, å…¶ä¸­åŒ…æ‹¬æ‰€æœ‰ä¸åŒçš„éƒ¨åˆ†, è¿™æ˜¯æ‰§è¡ŒJavaScriptä»£ç æ‰€å¿…é¡»çš„
    2. ç°åœ¨, æ¯ä¸ªJavaScriptè¿è¡Œæ—¶çš„æ ¸å¿ƒéƒ½æ˜¯å¼•æ“, æ‰€ä»¥, è¿™æ˜¯å®é™…æ‰§è¡Œä»£ç çš„åœ°æ–¹ä»¥åŠå¯¹è±¡å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ä½ç½®, æ‰€ä»¥ï¼Œè¿™ä¸¤ä»¶äº‹æƒ…å‘ç”Ÿåœ¨è°ƒç”¨å †æ ˆä¸­å¹¶åœ¨å †ä¸­
    3. JavaScriptåªæœ‰ä¸€ç§æ‰§è¡Œå¨èƒ, æ‰€ä»¥å®ƒä¸€æ¬¡åªèƒ½åšä¸€ä»¶äº‹, ç»å¯¹ä¸ä¼šå‘ç”Ÿå¤šä»»åŠ¡å¤„ç†, åœ¨JavaScriptæœ¬èº«ä¸­, ç°åœ¨javaç­‰å…¶ä»–è¯­è¨€å¯ä»¥æ‰§è¡Œå¤šä¸ªç‰‡æ®µä»£ç , ä½†æ˜¯JavaScriptæ˜¯ä¸å¯ä»¥çš„
    4. ä½†æ— è®ºå¦‚ä½•, æ¥ä¸‹æ¥æˆ‘ä»¬æœ‰ web APIç¯å¢ƒ, è¿™äº›æ˜¯æä¾›ç»™å¼•æ“çš„ä¸€äº›API, ä½†å®é™…ä¸Šä¸å±äºJavaScriptè¯­è¨€æœ¬èº«, æ‰€ä»¥, å°±åƒDOMè®¡æ—¶å™¨ fetch APIã€geolocation APIç­‰ç­‰.
    5. æ¥ä¸‹æ¥æ˜¯å›è°ƒé˜Ÿåˆ—, è¿™æ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰å‡†å¤‡å¥½çš„æ•°æ®ç»“æ„, è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°åˆ°ä¸€äº›å·²ç»å‘ç”Ÿçš„äº‹ä»¶, æœ€å, æ¯å½“è°ƒç”¨å †æ ˆä¸ºç©ºæ—¶, äº‹ä»¶å¾ªç¯ä»å›è°ƒé˜Ÿåˆ—ä¸­è·å–å›è°ƒ, å¹¶å°†å®ƒä»¬æ”¾å…¥è°ƒç”¨å †æ ˆ, ä»¥ä¾¿å®ƒä»¬å¯ä»¥è¢«æ‰§è¡Œ, å› æ­¤äº‹ä»¶å¾ªç¯æ˜¯å¿…ä¸å¯å°‘çš„, ä½¿å¼‚æ­¥è¡Œä¸ºæˆä¸ºå¯èƒ½çš„éƒ¨åˆ†, åœ¨JavaScriptä¸­.
    6.è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªJavaScriptä¸­çš„éå µå¡å¹¶å‘æ¨¡å‹, å¹¶å‘æ¨¡å‹åªæ˜¯è¯­è¨€å¤„ç†çš„æ–¹å¼å¤šä»¶äº‹æƒ…åŒæ—¶å‘ç”Ÿ, ä½†æ˜¯ç°åœ¨æ€ä¹ˆåŠ, éå µå¡å¹¶å‘çœŸçš„æœ‰æ•ˆå—ï¼Ÿä¸ºä»€ä¹ˆå¦‚æ­¤é‡è¦ï¼Ÿ
  äº‹ä»¶å¾ªç¯è¿è¡Œéƒ¨åˆ†ç ”ç©¶
    1. web API äº‹ä»¶å¾ªç¯çš„è°ƒç”¨å †æ ˆå¹¶å›è°ƒé˜Ÿåˆ—, æ‰€ä»¥, å¦‚ä½ æ‰€çŸ¥, åˆ°ç›®å‰ä½ç½®, å·²ç»æ„å»ºäº†ä¸€ä¸ªJavaScriptå¼•æ“å›´ç»•å•ä¸€å¨èƒçš„æƒ³æ³•, ä½†æ˜¯å¦‚æœå¼•æ“ä¸­åªæœ‰ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹, é‚£ä¹ˆå¦‚ä½•æ‰§è¡Œå¼‚æ­¥ä»£ç ä»¥éå µå¡æ–¹å¼ï¼Ÿ
    2. åŸºæœ¬ä¸Šä½ ä¼šå­¦åˆ° JavaScript å¹¶å‘æ¨¡å‹æ˜¯å¦‚ä½•å·¥ä½œçš„ åœ¨å¹•åï¼Œä½¿ç”¨æ‰€æœ‰éƒ¨åˆ† æ‚¨å·²ç»çŸ¥é“çš„ JavaScript è¿è¡Œæ—¶ã€‚ å’Œå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å°†é€šè¿‡æŸ¥çœ‹æ¥åšåˆ°è¿™ä¸€ç‚¹ åœ¨ä¸€ä¸ªçœŸå®çš„ä»£ç ç¤ºä¾‹ä¸­ã€‚é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä»£ç è¡Œ æŒ‰è¡Œï¼Œæˆ‘ä¼šåœ¨æˆ‘ä»¬è¿›è¡Œæ—¶ä¸æ–­æ›´æ–°è°ƒç”¨å †æ ˆï¼Œ ä½†æ˜¯ï¼Œæ‚¨å·²ç»çŸ¥é“å¦‚ä½•è°ƒç”¨å †æ ˆ 
  Codeã€Web APIã€Callback Queue(å›è°ƒé˜Ÿåˆ—)ç ”ç©¶
      Codeå’Œweb API
        1. æˆ‘ä»¬ä»é€‰æ‹©è¿™ä¸ªå›¾åƒå…ƒç´ å¼€å§‹, ç„¶ååœ¨ä¸‹ä¸€è¡Œ, æˆ‘ä»¬å°†è¯¥å›¾åƒçš„æºå±æ€§è®¾ç½®ä¸ºdog.jpg, æ­£å¦‚æˆ‘ä»¬ä¹‹å‰äº†è§£åˆ°çš„, ç°åœ¨å°†å¼€å§‹åŠ è½½æ­¤å›¾åƒåœ¨åå°å¼‚æ­¥, è¿™æ¬¡æˆ‘ä»¬å°†çœŸæ­£äº†è§£é‚£ä¸ªç¥ç§˜çš„èƒŒæ™¯ç©¶ç«Ÿæ˜¯ä»€ä¹ˆ (é‡ç‚¹)
        2. æ­£å¦‚æ‚¨å·²ç»çŸ¥é“ä¸DOMç›¸å…³çš„ä¸€åˆ‡å®é™…ä¸Šå¹¶ä¸æ˜¯JavaScriptçš„ä¸€éƒ¨åˆ†, è€Œæ˜¯web APIçš„ä¸€éƒ¨åˆ†, æ‰€ä»¥å®ƒåœ¨ä¸€ä¸ªweb APISç¯å¢ƒä¸­ä¸DOMç›¸å…³çš„å¼‚æ­¥ä»»åŠ¡å°†è¿è¡Œ
        3. äº‹å®ä¸Š, å¯¹äºå®šæ—¶å™¨AJAXè°ƒç”¨ä¹Ÿæ˜¯å¦‚æ­¤, ä»¥åŠæ‰€æœ‰å…¶ä»–å¼‚æ­¥ä»»åŠ¡, æ‰€ä»¥, åŒæ ·, è¿™äº›å¼‚æ­¥ä»»åŠ¡éƒ½ä¼šè¿è¡Œåœ¨æµè§ˆå™¨çš„web APIç¯å¢ƒä¸­, ç°åœ¨, å¦‚æœå›¾åƒå°†ä»¥åŒæ­¥æ–¹å¼åŠ è½½, å®ƒä¼šåœ¨è°ƒç”¨å †æ ˆä¸­é˜»æ­¢å…¶ä½™ä»£ç çš„æ‰§è¡Œ, å¦‚æˆ‘ä»¬äº†è§£çš„ä¸€æ ·, é‚£å°†æ˜¯å¯æ€•çš„
        4. è¿™å°±æ˜¯ä¸ºä»€ä¹ˆJavaScriptä¸­åŠ è½½å›¾åƒæ˜¯å¼‚æ­¥çš„, æ‰€ä»¥å®ƒä¸ä¼šå‘ç”Ÿåœ¨è°ƒç”¨å †æ ˆä¸­, æ‰€ä»¥, ä¸åœ¨æ‰§è¡Œçš„ä¸»çº¿ç¨‹ä¸­, ä½†å®é™…ä¸Šåœ¨web APIç¯å¢ƒä¸­æ­£å¦‚æˆ‘ä¹‹å‰æåˆ°çš„
        5. ç°åœ¨, å¦‚æœæˆ‘ä»¬æƒ³åœ¨å›¾åƒä¹‹ååšä¸€äº›äº‹æƒ…å·²å®ŒæˆåŠ è½½, ç„¶åæˆ‘ä»¬éœ€è¦ç›‘å¬loadäº‹ä»¶, åœ¨è¿™é‡Œæˆ‘ä»¬é™„åŠ ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨åˆ°è¯¥å›¾åƒçš„åŠ è½½äº‹ä»¶å¹¶åƒå¾€å¸¸ä¸€æ ·ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°
        6. åœ¨å®è·µä¸­, è¿™æ„å‘³ç€æ³¨å†Œè¿™ä¸ªå›è°ƒåœ¨web APIç¯å¢ƒä¸­, æ­£æ˜¯å›¾åƒåŠ è½½çš„ä½ç½®, å¹¶å°†å›è°ƒç•™åœ¨é‚£é‡Œ, ç›´åˆ°å‘å‡ºloadäº‹ä»¶
      fetchå‡½æ•°å’Œthenæ–¹æ³•
        1. æˆ‘ä»¬åœ¨è¿™é‡Œå¤„ç†å¼‚æ­¥è¡Œä¸º, å°±åƒæˆ‘ä»¬ä¹‹å‰å­¦åˆ°çš„é‚£æ ·å¸¦æœ‰å›è°ƒ, æˆ‘ä»¬ä½¿ç”¨AJAXè°ƒç”¨è·å–API, å’Œå¾€å¸¸ä¸€æ ·, å¼‚æ­¥è·å–æ“ä½œä¼šå‘ç”Ÿåœ¨web APIç¯å¢ƒä¸­, å¦åˆ™æˆ‘ä»¬ä¼šå µå¡è°ƒç”¨å †æ ˆå¹¶åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­é€ æˆå·¨å¤§çš„æ»å
        2. æˆ‘ä»¬å¯¹è¿”å›çš„æ‰¿è¯ºä½¿ç”¨thenæ–¹æ³•, é€šè¿‡fetchå‡½æ•°, è¿™ä¹Ÿå°†æ³¨å†Œä¸€ä¸ªå›è°ƒåœ¨web APIç¯å¢ƒä¸­, ä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åšå‡ºååº”åˆ°æ‰¿è¯ºæœªæ¥è§£å†³ä»·å€¼, æ‰€ä»¥è¿™ä¸ªå›è°ƒä¸ä¸€ä¸ªPromiseç›¸å…³è”, å³ä»APIè·å–æ•°æ®, è¿™ä»¥åä¼šå¾ˆé‡è¦
      å›è°ƒé˜Ÿåˆ—ä¸äº‹ä»¶å¾ªç¯
        1. æ‰€ä»¥, æœ‰äº†è¿™ä¸ª, æˆ‘ä»¬ç°åœ¨å·²ç»æ‰§è¡Œäº†æ‰€æœ‰é¡¶çº§ä»£ç , æ‰€cä»¥ä¸åœ¨ä»»ä½•å›è°ƒå‡½æ•°ä¸­çš„ä»£ç ä»¥å¼‚æ­¥æ–¹å¼, æˆ‘ä»¬è¿˜åœ¨åå°åŠ è½½å›¾åƒä»¥åŠä»APIè·å–ä¸€äº›æ•°æ®, ç°åœ¨éå¸¸æœ‰è¶£äº†, å½“é‡åˆ°å¤šä¸ªä¸åŒç±»å‹å¼‚æ­¥ä»»åŠ¡åº”è¯¥å¦‚ä½•æ‰§è¡Œï¼Ÿ(é‡ç‚¹)
        2.å‡è®¾å›¾åƒå·²ç»å®ŒæˆåŠ è½½, å› æ­¤åŠ è½½äº‹ä»¶ä¼šåœ¨è¯¥å›¾åƒä¸Šå‘å‡º, æ¥ä¸‹æ¥è¿™ä¸ªäº‹ä»¶çš„å›è°ƒè¿›å…¥å›è°ƒé˜Ÿåˆ—, å¹¶ä¸”å›è°ƒé˜Ÿåˆ—æ˜¯ä¸€ä¸ªæœ‰åºåˆ—è¡¨, æ‰€æœ‰å›è°ƒå‡½æ•°ä¸­æ’é˜Ÿæ‰§è¡Œ
        3. å¦‚æœå·²ç»æœ‰å…¶ä»–å›è°ƒç­‰å¾…, é‚£ä¹ˆè¿™ä¸ªæ–°å›è°ƒå½“ç„¶ä¼šç›´æ¥è¿›å…¥åˆ°é˜Ÿåˆ—çš„æœ«å°¾, å®ƒä¼šè€å¿ƒåœ°ååœ¨é‚£é‡Œè½®åˆ°å®ƒæœ€åè¿è¡Œ
          è®¡æ—¶å™¨æ¡ˆä¾‹è¯´æ˜
            1. å‡è®¾æ‚¨å°†è®¡æ—¶å™¨è®¾ç½®ä¸º5 ç§’. æ‰€ä»¥äº”ç§’é’Ÿå, è®¡æ—¶å™¨çš„å›è°ƒå°†è¢«æ”¾ç½® åœ¨å›è°ƒé˜Ÿåˆ—ä¸Š, å¯¹. å‡è®¾å·²ç»æœ‰å…¶ä»–å›è°ƒåœ¨ç­‰å¾…. è®©æˆ‘ä»¬ä¹Ÿè¯´å®ƒèŠ±äº†ä¸€ç§’é’Ÿ è¿è¡Œæ‰€æœ‰è¿™äº›å›è°ƒ. ç„¶å, åœ¨è¿™ç§æƒ…å†µä¸‹, æ‚¨çš„è®¡æ—¶å™¨å›è°ƒåªä¼šè¿è¡Œ å…­ç§’åè€Œä¸æ˜¯äº”ç§’å. æ‰€ä»¥, è¿™å…­ç§’å°±æ˜¯è¿‡å»çš„äº”ç§’ å¯¹äºè®¡æ—¶å™¨, åŠ ä¸Šå®ƒèŠ±è´¹çš„ä¸€ç§’ è¿è¡Œå·²ç»åœ¨ç­‰å¾…çš„æ‰€æœ‰å…¶ä»–å›è°ƒ åœ¨ä½ çš„è®¡æ—¶å™¨å‰æ’é˜Ÿ. æ‰€ä»¥, è¿™æ„å‘³ç€è®¡æ—¶å™¨çš„æŒç»­æ—¶é—´ æ‚¨å®šä¹‰çš„ä¸æ˜¯ä¿è¯. å”¯ä¸€çš„ä¿è¯æ˜¯å®šæ—¶å™¨å›è°ƒ ä¸ä¼šåœ¨äº”ç§’å‰è¿è¡Œ,  ä½†å®ƒå¯èƒ½ä¼šåœ¨äº”ç§’é’Ÿè¿‡å»åè¿è¡Œ, è¿™ä¸€åˆ‡éƒ½å–å†³äºå›è°ƒé˜Ÿåˆ—çš„çŠ¶æ€.
          DOMå®é™…æ¡ˆä¾‹è¯´æ˜
            1. æœ‰ä¸€ä»¶å¾ˆé‡è¦çš„äº‹æƒ…è¦åœ¨è¿™é‡ŒæåŠæ˜¯å›è°ƒé˜Ÿåˆ—è¿˜åŒ…å«å³å°†åˆ°æ¥çš„å›è°ƒæ¥è‡ªDOMäº‹ä»¶, å¦‚ç‚¹å‡»æˆ–æŒ‰é”®ç­‰ã€‚ ç°åœ¨, æˆ‘ä»¬ä¹‹å‰äº†è§£åˆ° DOM äº‹ä»¶å¹¶ä¸æ˜¯çœŸçš„å¼‚æ­¥è¡Œä¸º, ä½†ä»–ä»¬ä»ç„¶ä½¿ç”¨ å›è°ƒé˜Ÿåˆ—è¿è¡Œå…¶é™„åŠ çš„å›è°ƒã€‚ å› æ­¤, å¦‚æœå•å‡»å‘ç”Ÿåœ¨å¸¦æœ‰ addEventListener çš„æŒ‰é’®ä¸Š é‚£ä¹ˆå°†ä¼šå‘ç”Ÿçš„äº‹æƒ…å°±åƒæˆ‘åœ¨è¿™é‡Œè¯´æ˜çš„é‚£æ ·ä¸å¼‚æ­¥åŠ è½½äº‹ä»¶
          äº‹ä»¶å¾ªç¯è¯´æ˜
            1. æŸ¥çœ‹è°ƒç”¨å †æ ˆå¹¶ç¡®å®šæ˜¯å¦ä¸ºç©º, å½“ç„¶, é™¤äº†å…¨çƒèƒŒæ™¯, å¦‚æœå †æ ˆç¡®å®æ˜¯ç©ºçš„, è¿™æ„å‘³ç€å½“å‰æ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»£ç , ç„¶åå®ƒå°†ä»å›è°ƒé˜Ÿåˆ—ä¸­è·å–ç¬¬ä¸€ä¸ªå›è°ƒ, å¹¶å°†å…¶æ”¾åœ¨è°ƒç”¨å †æ ˆä¸­, ä¸¤ä¸ªå°†è¢«æ‰§è¡Œ, è¿™ç§°ä¸ºäº‹ä»¶å¾ªç¯æ»´ç­”
            2. æ¯æ¬¡äº‹ä»¶å¾ªç¯éƒ½æœ‰ä¸€ä¸ªå›è°ƒä»å›è°ƒé˜Ÿåˆ—, æˆ‘ä»¬è¯´æœ‰ä¸€ä¸ªäº‹ä»¶å¾ªç¯æ»´ç­”, æ‰€ä»¥, æ­£å¦‚æˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°çš„, äº‹ä»¶å¾ªç¯æœ‰ç€æå…¶é‡è¦çš„ä»»åŠ¡, è°ƒç”¨å †æ ˆä¹‹é—´çš„åè°ƒå’Œå›è°ƒé˜Ÿåˆ—ä¸­çš„å›è°ƒ
            3. äº‹ä»¶å¾ªç¯åŸºæœ¬ä¸Šç”±è°æ¥å†³å®š, å½“æ¯ä¸ªå›è°ƒè¢«æ‰§è¡Œæ—¶, æˆ‘ä»¬ä¹Ÿå¯ä»¥è¯´äº‹ä»¶å¾ªç¯åšäº†ç¼–æ’åœ¨æ•´ä¸ªJavaScriptè¿è¡Œæ—¶, ä»æ•´ä¸ªè§£é‡Šä¸­, å¯ä»¥æ¸…é™¤åœ°çœ‹å‡ºå¦ä¸€äº‹ä»¶æ—¶JavaScriptè¯­è¨€æœ¬èº«å®é™…ä¸Šå…·æœ‰æ²¡æœ‰æ—¶é—´æ„Ÿ, é‚£æ˜¯å› ä¸ºä¸€åˆ‡éƒ½æ˜¯å¼‚æ­¥çš„, ä¸ä¼šå‘ç”Ÿåœ¨å¼•æ“ä¸­(é‡ç‚¹)
            4. ç®¡ç†æ‰€æœ‰å¼‚æ­¥è¡Œä¸ºçš„æ˜¯è¿è¡Œæ—¶, ç”±äº‹ä»¶å¾ªç¯å†³å®šæ¥ä¸‹æ¥æ‰§è¡Œå“ªäº›ä»£ç , ä½†æ˜¯å¼•æ“æœ¬èº«åªæ˜¯ç®€å•åœ°æ‰§è¡Œå®ƒç»™å‡ºçš„ä»£ç (é‡ç‚¹)
        
    è¯¾ç¨‹å›é¡¾ï¼š
      å¥½çš„ï¼Œæ‰€ä»¥ï¼Œè¿™å½“ç„¶æœ‰å¾ˆå¤šä¸œè¥¿è¦è€ƒè™‘ã€‚ å› æ­¤ï¼Œè®©æˆ‘ä»¬å°è¯•å›é¡¾ä¸€ä¸‹è¿™é‡Œå‘ç”Ÿçš„äº‹æƒ…ã€‚ å› æ­¤ï¼Œå›¾åƒå¼€å§‹å¼‚æ­¥åŠ è½½ åœ¨ Web API ç¯å¢ƒä¸­ è€Œä¸æ˜¯åœ¨è°ƒç”¨å †æ ˆä¸­ï¼Œå¯¹ã€‚ ç„¶åæˆ‘ä»¬ä½¿ç”¨ addEventListener æ¥é™„åŠ  å›¾åƒåŠ è½½äº‹ä»¶çš„å›è°ƒå‡½æ•°ã€‚ è€Œè¿™ä¸ªå›è°ƒåŸºæœ¬ä¸Šè¿˜æ˜¯å¼‚æ­¥ä»£ç  è¿™æ˜¯æˆ‘ä»¬æ¨è¿Ÿåˆ°æœªæ¥çš„ä»£ç  å› ä¸ºæˆ‘ä»¬åªæƒ³æ‰§è¡Œä¸€æ¬¡å›¾åƒ å·²åŠ è½½ã€‚ ä¸æ­¤åŒæ—¶ï¼Œå…¶ä½™çš„ä»£ç ç»§ç»­è¿è¡Œã€‚ (ç°åœ¨addEventListeneræ²¡æœ‰ç›´æ¥æ”¾å›è°ƒ åœ¨å›è°ƒé˜Ÿåˆ—ä¸­)ã€‚ å®ƒåªæ˜¯æ³¨å†Œäº†å›è°ƒï¼Œç„¶åä¸€ç›´ç­‰å¾… åœ¨ Web API ç¯å¢ƒä¸­ï¼Œç›´åˆ°åŠ è½½äº‹ä»¶ è¢«è§£é›‡äº†ã€‚ åªæœ‰è¿™æ ·ï¼Œç¯å¢ƒæ‰å°†å‘¼å«æ”¾å›é˜Ÿåˆ—ä¸­ã€‚ ç„¶ååœ¨é˜Ÿåˆ—ä¸­å›è°ƒä¸€ç›´åœ¨ç­‰å¾… è®©äº‹ä»¶å¾ªç¯æŠŠå®ƒæ¡èµ·æ¥ å¹¶å°†å…¶æ”¾åœ¨è°ƒç”¨å †æ ˆä¸­ã€‚ ä¸€æ—¦å›è°ƒæ’åœ¨ç¬¬ä¸€ä½ï¼Œè¿™å°±ä¼šå‘ç”Ÿ å¹¶ä¸”è°ƒç”¨å †æ ˆæ˜¯ç©ºçš„ã€‚ è€Œä¸”ï¼Œå®é™…ä¸Šå°±æ˜¯è¿™æ ·ã€‚ æ‰€ä»¥ï¼Œè¿™ä¸€åˆ‡éƒ½å‘ç”Ÿäº†ï¼Œå›¾åƒä¸å¿…åŠ è½½ åœ¨è°ƒç”¨å †æ ˆä¸­ï¼Œä½†åœ¨åå° ä»¥éé˜»å¡æ–¹å¼ã€‚ å› æ­¤ï¼Œç®€è€Œè¨€ä¹‹ï¼ŒWeb API ç¯å¢ƒï¼Œ å›è°ƒé˜Ÿåˆ— å’Œäº‹ä»¶å¾ªç¯ä¸€èµ·ï¼Œä½¿å®ƒæˆä¸ºå¯èƒ½ å¼‚æ­¥ä»£ç å¯ä»¥ä»¥éé˜»å¡æ–¹å¼æ‰§è¡Œ å³ä½¿å¼•æ“ä¸­åªæœ‰ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹ã€‚ å“‡ï¼Œå·²ç»æ˜ç™½äº†å¾ˆå¤šï¼Œ ä½†æˆ‘ä»¬è¿˜æ²¡æœ‰å®Œæˆã€‚å› ä¸ºæˆ‘ä»¬è¿˜å¾—è·å– fetch å‡½æ•° åœ¨åå°ä» AJAX è°ƒç”¨ä¸­è·å–æ•°æ®ã€‚ è¿™åŸºæœ¬ä¸Šæ˜¯åœ¨æ‰¿è¯ºçš„æƒ…å†µä¸‹å‘ç”Ÿçš„ã€‚ è®°ä½ï¼Œç°åœ¨æœ‰äº† promisesï¼Œäº‹æƒ…å°±ç¨å¾®å˜å¥½äº† ä¸åŒçš„æ–¹å¼ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘åŒ…å«è¿™ä¸ªæ‰¿è¯ºç¤ºä¾‹ ä»¥åŠã€‚ æ‰€ä»¥ï¼Œå‡è®¾æ•°æ®ç°åœ¨ç»ˆäºåˆ°è¾¾äº†ã€‚ è¿™æ ·æŠ“å–å°±å®Œæˆäº†ã€‚ ç°åœ¨ï¼Œä¸æ‰¿è¯ºç›¸å…³çš„å›è°ƒ å°±åƒæˆ‘ä»¬æ³¨å†Œçš„è¿™ä¸ª æ‰¿è¯ºthenæ–¹æ³•ã€‚ å®é™…ä¸Šä¸è¦è¿›å…¥å›è°ƒé˜Ÿåˆ—ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿˜æœ‰è¿™ä¸ªå›è°ƒå—ï¼Ÿ æ¥è‡ªæ‰¿è¯ºçš„ä¸ä¼šè¢«ç§»åŠ¨åˆ° å›è°ƒé˜Ÿåˆ—ã€‚ ç›¸åï¼Œ(promise çš„å›è°ƒæœ‰ä¸€ä¸ªç‰¹æ®Šçš„é˜Ÿåˆ— å¯¹äºä»–ä»¬è‡ªå·±ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„å¾®ä»»åŠ¡é˜Ÿåˆ—)ã€‚ (ç°åœ¨ï¼Œå¾®ä»»åŠ¡é˜Ÿåˆ—çš„ç‰¹åˆ«ä¹‹å¤„åœ¨äº å®ƒåŸºæœ¬ä¸Šä¼˜å…ˆäºå›è°ƒé˜Ÿåˆ—ã€‚) å› æ­¤ï¼Œåœ¨äº‹ä»¶å¾ªç¯æ»´ç­”ç»“æŸæ—¶ï¼Œ æ‰€ä»¥åœ¨å›è°ƒä¹‹å ä»å›è°ƒé˜Ÿåˆ—ä¸­ï¼Œäº‹ä»¶å¾ªç¯å°†æ£€æŸ¥ å¦‚æœå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­æœ‰ä»»ä½•å›è°ƒã€‚ (å¦‚æœæœ‰ï¼Œå®ƒå°†è¿è¡Œæ‰€æœ‰è¿™äº›åœ¨å®ƒè¿è¡Œæ›´å¤šå›è°ƒä¹‹å‰æ¥è‡ªå¸¸è§„å›è°ƒé˜Ÿåˆ—)ã€‚ è€Œä¸”ï¼Œé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæˆ‘ä»¬ç§°è¿™äº›å›è°ƒ æ¥è‡ªæ‰¿è¯ºå¾®ä»»åŠ¡ã€‚ å› æ­¤åç§°å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚ å®é™…ä¸Šè¿˜æœ‰å…¶ä»–å¾®ä»»åŠ¡ ä½†è¿™åœ¨è¿™é‡Œæ— å…³ç´§è¦ã€‚ å›åˆ°æˆ‘ä»¬çš„ä¾‹å­ï¼Œ ç›®å‰ï¼Œæˆ‘ä»¬ç¡®å®æœ‰ä¸€ä¸ªå¾®ä»»åŠ¡å åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œè°ƒç”¨æ ˆä¹Ÿæ˜¯ç©ºçš„ã€‚ å› æ­¤äº‹ä»¶å¾ªç¯ç°åœ¨å°†æ¥å—è¿™ä¸ªå›è°ƒ å¹¶å°†å…¶æ”¾å…¥è°ƒç”¨å †æ ˆä¸­ï¼Œå°±åƒå®ƒæ‰€åšçš„é‚£æ · æ¥è‡ªå›è°ƒé˜Ÿåˆ—çš„å›è°ƒã€‚ å›è°ƒé˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºå¹¶ä¸é‡è¦ã€‚ æ‰€ä»¥ï¼Œè¿™ä¼šä»¥å®Œå…¨ç›¸åŒçš„æ–¹å¼å·¥ä½œ å³ä½¿å›è°ƒé˜Ÿåˆ—ä¸­æœ‰ä¸€äº›å›è°ƒã€‚ å†ä¸€æ¬¡ï¼Œé‚£æ˜¯(å› ä¸ºå¾®ä»»åŠ¡æ€»æ˜¯å…·æœ‰ä¼˜å…ˆæƒã€‚ åœ¨å®è·µä¸­ï¼Œè¿™æ„å‘³ç€å¾®ä»»åŠ¡åŸºæœ¬ä¸Šå¯ä»¥ åœ¨æ‰€æœ‰å…¶ä»–å¸¸è§„å›è°ƒä¹‹å‰æ’é˜Ÿ)ã€‚ ç°åœ¨ï¼Œå¦‚æœä¸€ä¸ªå¾®ä»»åŠ¡æ·»åŠ äº†ä¸€ä¸ªæ–°çš„å¾®ä»»åŠ¡ ç„¶åé‚£ä¸ªæ–°çš„å¾®ä»»åŠ¡ä¹Ÿè¢«æ‰§è¡Œ åœ¨å›è°ƒé˜Ÿåˆ—ä¸­çš„ä»»ä½•å›è°ƒä¹‹å‰ã€‚ è¿™æ„å‘³ç€å¾®ä»»åŠ¡é˜Ÿåˆ— åŸºæœ¬ä¸Šå¯ä»¥ä½¿å›è°ƒé˜Ÿåˆ—æŒ¨é¥¿ã€‚ å› ä¸ºå¦‚æœæˆ‘ä»¬ä¸æ–­æ·»åŠ è¶Šæ¥è¶Šå¤šçš„å¾®ä»»åŠ¡ï¼Œ é‚£ä¹ˆå›è°ƒé˜Ÿåˆ—ä¸­çš„å›è°ƒæ°¸è¿œæ— æ³•æ‰§è¡Œã€‚ ç°åœ¨ï¼Œè¿™é€šå¸¸ä¸æ˜¯é—®é¢˜ ä½†æ— è®ºå¦‚ä½•æˆ‘åªæƒ³åœ¨è¿™é‡Œæåˆ°è¿™ç§å¯èƒ½æ€§ï¼Œ è°çŸ¥é“è¿™å¯èƒ½æ˜¯ä¸€ä¸ªé¢è¯•é—®é¢˜ æ€»æœ‰ä¸€å¤©ä¸ºäº†ä½ ã€‚ å¦‚æœæ˜¯è¿™æ ·ï¼Œä½ ç°åœ¨å°±çŸ¥é“ç­”æ¡ˆäº†ã€‚ ä½†æ— è®ºå¦‚ä½•ï¼Œæ­£å¦‚ä½ å¸Œæœ›çœ‹åˆ°çš„é‚£æ · ä½¿ç”¨å¸¸è§„å›è°ƒè¿è¡Œå¼‚æ­¥ä»£ç  æ¥è‡ª promise çš„å¾®ä»»åŠ¡éå¸¸ç›¸ä¼¼ã€‚ (å”¯ä¸€çš„åŒºåˆ«æ˜¯ä»–ä»¬è¿›å…¥ä¸åŒçš„é˜Ÿåˆ— å¹¶ä¸”äº‹ä»¶å¾ªç¯ç»™äºˆå¾®ä»»åŠ¡ä¼˜å…ˆæƒ é€šè¿‡å¸¸è§„å›è°ƒã€‚) å¥½äº†ï¼Œç»ˆäºåˆ°äº†ã€‚ è¿™å°±æ˜¯ä½ éœ€è¦çŸ¥é“çš„ä¸€åˆ‡ å¼‚æ­¥ JavaScript ç¡®å®åœ¨å¹•åå·¥ä½œã€‚ æˆ‘ç›¸ä¿¡è¿™äº›çŸ¥è¯†å°†ä¼šæ˜¯ å¯¹æ‚¨éå¸¸æœ‰å¸®åŠ©å’Œä»·å€¼ã€‚ å› ä¸ºä½ ä¼šæ›´æœ‰ä¿¡å¿ƒå†™ä½œ ç°åœ¨å¼‚æ­¥ä»£ç ã€‚è€Œä¸”ä½ ä¼šå›ç­”ä»»ä½•é¢è¯•é—®é¢˜ å…³äºå¼‚æ­¥ JavaScriptã€‚ å®é™…ä¸Šå¾ˆå¤š JavaScript å¼€å‘äººå‘˜ä¸çŸ¥é“ å…³äºè¿™ä¸ªçš„ä»»ä½•äº‹æƒ…ã€‚ (æ‰€ä»¥ï¼Œæˆ‘ç›¸ä¿¡è¿™äº›çŸ¥è¯†ä¼šè®©ä½  è¿›å…¥å‰ 10% ç”šè‡³å‰ 5% çš„ JavaScript å¼€å‘äººå‘˜)ã€‚ è¿™æœ¬èº«å°±å¾ˆæ£’ï¼Œå¯¹å§ã€‚ ä½†æ— è®ºå¦‚ä½•ï¼Œè®©æˆ‘ä»¬åœ¨è¿™é‡Œæ²¡æœ‰ç»“æŸ å¹¶åœ¨å®è·µä¸­å°è¯•ä¸€äº›è¿™äº›ä¸œè¥¿
*/

/************** å®è·µä¸­çš„äº‹ä»¶å¾ªç¯ */
// å®è·µä¸­çš„äº‹ä»¶å¾ªç¯å°±æ˜¯æŒ‰ç…§æ­¤é¡ºåºä¸€ä¸€è¿›è¡Œçš„
// // 1
// console.log('Test start');
// // 5
// setTimeout(() => console.log('0 sec timer'), 5000);
// // 3
// Promise.resolve('Resolved promise 1').then(res => console.log(res));
// // 4
// Promise.resolve('Resolved promise 2').then(res => {
//   for (let i = 0; i < 1000; i++) {
//     console.log(res);
//   }
// });
// // 2
// console.log('Test end');

/************** æ„å»ºä¸€ä¸ªç®€å•çš„Promise */
/*
  1. å¤ªå¥½äº†, è¿™å°±æ˜¯æˆ‘ä»¬ä»¥å°è£…çš„æ–¹å¼å°†å¼‚æ­¥è¡Œä¸ºè½¬åŒ–ä¸ºæ‰¿è¯º, æ‰€ä»¥æˆ‘ä»¬å¦‚ä½•ä»¥ä¸€ç§éå¸¸å¥½çš„æ–¹å¼æŠ½è±¡å‡ºæ¥, å°±åƒæˆ‘ä»¬è¿™é‡Œæ‰€åšçš„ä¸€æ ·
*/
const lotteryPromise = new Promise(function (resolve, reject) {
  console.log('Lotter draw is happening ğŸ˜€');

  setTimeout(function () {
    if (Math.random() >= 0.5) {
      resolve('You win $$$');
    } else {
      reject(new Error('You lost your money!!'));
    }
  }, 2000);
});

lotteryPromise.then(res => console.log(res)).catch(err => console.error(err));

// å¦‚ä½•é€šè¿‡æ‰¿è¯ºè®¾ç½®è®¡æ—¶å™¨
// const wait = function (seconds) {
//   return new Promise(function (resolve) {
//     setTimeout(resolve, seconds * 1000);
//   });
// };

// æ¯ä¸€ä¸ªthenæ–¹æ³•éƒ½è¿”å›ä¸€ä¸ªè®¡æ—¶å™¨æ‰¿è¯º, ç„¶åé€šè¿‡thenå†æ¶ˆè´¹æ‰¿è¯º
// wait(1)
//   .then(() => {
//     console.log('I waited for 1 seconds');
//     return wait(1);
//   })
//   .then(() => {
//     console.log('I waited for 2 seconds');
//     return wait(1);
//   })
//   .then(() => {
//     console.log('I waited for 3 seconds');
//     return wait(1);
//   })
//   .then(() => {
//     console.log('I waited for 4 seconds');
//   });

// setTimeout(() => {
//   console.log('1 second passed');
//   setTimeout(() => {
//     console.log('2 seconds passed');
//     setTimeout(() => {
//       console.log('3 second passed');
//       setTimeout(() => {
//         console.log('4 second passed');
//       }, 1000);
//     }, 1000);
//   }, 1000);
// }, 1000);

// æ‰¿è¯ºä¸­çš„é™æ€æ–¹æ³•
// Promise.resolve('abc').then(x => console.log(x));
// Promise.reject('abc').catch(x => console.error(x));

/************** æ‰¿è¯º Geolocation API */

// å¯¼èˆªå™¨åœ°ç†ä½ç½®è·å–å½“å‰ä½ç½®
// ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæˆåŠŸå¾—åˆ°ä½ç½®ä¿¡æ¯æ—¶çš„å›è°ƒå‡½æ•°ï¼Œä½¿ç”¨Position å¯¹è±¡ä½œä¸ºå”¯ä¸€çš„å‚æ•°
// ç¬¬äºŒä¸ªå‚æ•°ï¼šè·å–ä½ç½®ä¿¡æ¯å¤±è´¥æ—¶çš„å›è°ƒå‡½æ•°ï¼Œä½¿ç”¨ PositionError å¯¹è±¡ä½œä¸ºå”¯ä¸€çš„å‚æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯é€‰é¡¹

// navigator.geolocation.getCurrentPosition(
//   position => console.log(position),
//   err => console.error(err)
// );
// getPosition().then(pos => console.log(pos));

// å»ºç«‹ä¸€ä¸ªæ‰¿è¯ºæœªæ¥è·å–å½“å‰åœ°ç†ä½ç½®çš„ç»çº¬åº¦
// const getPosition = function () {
//   return new Promise(function (resolve, reject) {
//     navigator.geolocation.getCurrentPosition(resolve, reject);
//   });
// };

// const whereAmI = function () {
//   getPosition()
//     .then(pos => {
//       const { latitude: lat, longitude: lng } = pos.coords;
//       return fetch(`https://geocode.xyz/${lat},${lng}?geoit=json`);
//     })
//     .then(res => {
//       console.log(res);
//       if (!res.ok) throw new Error(`Problem with geocoding ${res.status}`);
//       return res.json();
//     })
//     .then(data => {
//       console.log(data);
//       console.log(`You are in ${data.city}, ${data.country}`);

//       return fetch(`https://restcountries.com/v3/name/china`);
//     })
//     .then(res => {
//       if (!res.ok) throw new Error(`Country not found (${res.status})`);
//       return res.json();
//     })
//     .then(data => renderCountry(data[0]))
//     .catch(err => console.error(`${err.message}`));
// };

// btn.addEventListener('click', whereAmI);

/************** Coding Challenge #2 (ç¼–ç æŒ‘æˆ˜#2) */
/*

æ„å»ºæˆ‘åˆšåˆšåœ¨å±å¹•ä¸Šå‘æ‚¨å±•ç¤ºçš„å›¾åƒåŠ è½½åŠŸèƒ½ã€‚

è¿™æ¬¡çš„ä»»åŠ¡ä¸æ˜¯è¶…çº§æè¿°æ€§çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥è‡ªå·±å¼„æ¸…æ¥šä¸€äº›ä¸œè¥¿ã€‚å‡è£…ä½ åœ¨è‡ªå·±å·¥ä½œğŸ˜‰

ç¬¬1éƒ¨åˆ†
1. åˆ›å»ºä¸€ä¸ªå‡½æ•°â€œcreateImageâ€ï¼Œå®ƒæ¥æ”¶ imgPath ä½œä¸ºè¾“å…¥ã€‚æ­¤å‡½æ•°è¿”å›ä¸€ä¸ªåˆ›å»ºæ–°å›¾åƒçš„æ‰¿è¯ºï¼ˆä½¿ç”¨ document.createElement('img')ï¼‰å¹¶å°† .src å±æ€§è®¾ç½®ä¸ºæä¾›çš„å›¾åƒè·¯å¾„ã€‚å›¾åƒåŠ è½½å®Œæˆåï¼Œå°†å…¶é™„åŠ åˆ°å…·æœ‰â€œå›¾åƒâ€ç±»çš„ DOM å…ƒç´ ï¼Œå¹¶è§£ææ‰¿è¯ºã€‚æ»¡è¶³çš„å€¼åº”è¯¥æ˜¯å›¾åƒå…ƒç´ æœ¬èº«ã€‚å¦‚æœåŠ è½½å›¾åƒæ—¶å‡ºé”™ï¼ˆ'error' äº‹ä»¶ï¼‰ï¼Œåˆ™æ‹’ç»æ‰¿è¯ºã€‚

å¦‚æœè¿™éƒ¨åˆ†å¯¹æ‚¨æ¥è¯´å¤ªæ£˜æ‰‹ï¼Œè¯·è§‚çœ‹è§£å†³æ–¹æ¡ˆçš„ç¬¬ä¸€éƒ¨åˆ†ã€‚

ç¬¬2éƒ¨åˆ†
2. ä½¿ç”¨ .then æ¥å— promise å¹¶æ·»åŠ é”™è¯¯å¤„ç†ç¨‹åºï¼›
3. å›¾åƒåŠ è½½å®Œæˆåï¼Œä½¿ç”¨æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„ç­‰å¾…å‡½æ•°æš‚åœæ‰§è¡Œ 2 ç§’ï¼›
4. 2 ç§’è¿‡å»åï¼Œéšè—å½“å‰å›¾åƒï¼ˆè®¾ç½® display ä¸º 'none'ï¼‰ï¼Œå¹¶åŠ è½½ç¬¬äºŒä¸ªå›¾åƒï¼ˆæç¤ºï¼šä½¿ç”¨ createImage æ‰¿è¯ºè¿”å›çš„å›¾åƒå…ƒç´ éšè—å½“å‰å›¾åƒã€‚æ‚¨å°†éœ€è¦ä¸€ä¸ªå…¨å±€å˜é‡ ğŸ˜‰);
5.ç¬¬äºŒå¼ å›¾ç‰‡åŠ è½½å®Œæ¯•åï¼Œå†æ¬¡æš‚åœæ‰§è¡Œ2ç§’ï¼›
6. 2 ç§’è¿‡åï¼Œéšè—å½“å‰å›¾åƒã€‚

æµ‹è¯•æ•°æ®ï¼šimg æ–‡ä»¶å¤¹ä¸­çš„å›¾åƒã€‚é€šè¿‡ä¼ é€’é”™è¯¯çš„å›¾åƒè·¯å¾„æ¥æµ‹è¯•é”™è¯¯å¤„ç†ç¨‹åºã€‚åœ¨å¼€å‘å·¥å…·ç½‘ç»œé€‰é¡¹å¡ä¸­å°†ç½‘ç»œé€Ÿåº¦è®¾ç½®ä¸ºâ€œFast 3Gâ€ï¼Œå¦åˆ™å›¾åƒåŠ è½½é€Ÿåº¦è¿‡å¿«ã€‚

ç¥ä½ å¥½è¿ğŸ˜€

*/
// const wait = function (seconds) {
//   return new Promise(function (resolve) {
//     setTimeout(resolve, seconds * 1000);
//   });
// };

// const imgContainer = document.querySelector('.images');

// const createImage = function (imgPath) {
//   return new Promise(function (resolve, reject) {
//     const img = document.createElement('img');
//     img.src = imgPath;

//     img.addEventListener('load', function () {
//       imgContainer.append(img);
//       resolve(img);
//     });

//     img.addEventListener('error', function () {
//       reject(new Error('Image not found'));
//     });
//   });
// };

// let currentImg;

// createImage('img/img-1.jpg')
//   .then(img => {
//     currentImg = img;
//     console.log('Image 1 loaded');
//     return wait(2);
//   })
//   .then(() => {
//     currentImg.style.opacity = 0;
//     return createImage('img/img-2.jpg');
//   })
//   .then(img => {
//     currentImg = img;
//     console.log('Image 2 loaded');
//     return wait(2);
//   })
//   .then(() => {
//     currentImg.style.opacity = 0;
//   })
//   .catch(err => console.error(err));

/************** ä½¿ç”¨ Async/Await æ¶ˆè´¹ Promise */
/*
  1. asyncæ—¶ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°, åŒæ­¥åŠŸèƒ½æ·»åŠ asyncå, å‡½æ•°æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°, åœ¨è¿™ä¹‹å‰æˆ‘ä»¬å¯ä»¥é€šè¿‡å›è°ƒåœ°ç‹±å’Œthen()æ–¹æ³•æ¶ˆè€—å‰æå®Œæˆå¼‚æ­¥å›è°ƒå¤„ç†
  2. awaitå…³é”®å­—åŸºæœ¬ä¸Šç­‰å¾…è¿™ä¸ªå‰æç»“æœ, æ‰€ä»¥åŸºæœ¬ä¸Šawaitå°†åœ¨æ­¤åœæ­¢è§£ç æ‰§è¡Œå‡½æ•°çš„ç‚¹, ç›´åˆ°æ»¡è¶³å‰æ, è¯¥å…³é”®å­—awaitä½¿ JavaScript ç­‰å¾…ï¼Œç›´åˆ°è¯¥æ‰¿è¯ºè§£å†³å¹¶è¿”å›å…¶ç»“æœ
  3. ä½ å¯èƒ½è®¤ä¸ºæ²¡æœ‰åœæ­¢ä»£ç , é˜»æ­¢æ‰§è¡Œï¼Ÿ å—¯, è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜, ä½†ç­”æ¡ˆå®é™…ä¸Šæ˜¯å¦å®šçš„, åœ¨è¿™ç§æƒ…å†µä¸‹, å› ä¸ºåœ¨åŒæ­¥å‡½æ•°ä¸­åœæ­¢æ‰§è¡Œ, è¿™å°±æ˜¯æˆ‘è¿™é‡Œæ‰€æ‹¥æœ‰çš„å®é™…ä¸Šä¸æ˜¯é—®é¢˜, å› ä¸ºæ­¤å‡½æ•°åœ¨åå°å¼‚æ­¥è¿è¡Œ
  4. å› æ­¤, å®ƒæ²¡æœ‰é˜»æ­¢ä¸»è¦å¨èƒæ‰§è¡Œ, æ‰€ä»¥å®ƒä¸ä¼šå µå¡è°ƒç”¨å †æ ˆ, äº‹å®ä¸Š, é‚£æ˜¯ä¸€æ¬¡ç­‰å¾…æœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„, æ‰€ä»¥äº‹å®æ˜¯å®ƒä½¿æˆ‘ä»¬ä»£ç çœ‹èµ·æ¥åƒå¸¸è§„åœ¨å¹•ååŒæ­¥ä»£ç , ä¸€åˆ‡å®é™…ä¸Šéƒ½æ˜¯å¼‚æ­¥çš„
  5. æ— è®ºå¦‚ä½•, åªè¦è¿™é‡Œçš„è¿™ä¸ªå‰æè§£å†³äº†, é‚£ä¹ˆæˆ‘ä»¬æ‹¥æœ‰çš„æ•´ä¸ªawaitè¡¨è¾¾å¼çš„å€¼, è¿™é‡Œå°†æ˜¯å‰æçš„è§£æå€¼, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†å®ƒå­˜å‚¨åˆ°ä¸€ä¸ª(å˜é‡ä¸­), æˆ‘ä»¬ç§°ä¹‹ä¸ºresponse(é‡ç‚¹)
*/

// const whereAmI = async function () {
//   // åœ°ç†ä½ç½®
//   const pos = await getPosition();
//   const { latitude: lat, longitude: lng } = pos.coords;
//   console.log(lat, lng);
//   // åå‘ç¼–ç 
//   const resGeo = await fetch(`https://geocode.xyz/${lat},${lng}?geoit=json`);
//   console.log(resGeo);
//   const dataGeo = await resGeo.json();
//   console.log(dataGeo);

//   const res = await fetch(
//     `https://restcountries.com/v2/name/${dataGeo.country}`
//   );
//   console.log(res);
//   const data = await res.json();
//   console.log(data);
//   renderCountry(data[0]);
// };

// whereAmI();
// console.log('FIRST');

/************** ä½¿ç”¨ try ...catch å¤„ç†é”™è¯¯ */
/*
  1. asyncå¼‚æ­¥å‡½æ•°æ— æ³•ä½¿ç”¨catchæ–¹æ³•

  2. å¯¹äºfetchæ‰¿è¯º, åªä¼šæ‹’ç»å½“äº’è”ç½‘æ²¡æœ‰è¿æ¥æ—¶, å‡ºç°çš„404, 403é”™è¯¯ä¼šè·å–æ‰¿è¯ºä¸ä¼šæ‹’ç», æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å®Œæˆ, ä¹Ÿåœ¨è¿™é‡Œ
  3. try...catchè¯­å¥æ ‡è®°è¦å°è¯•çš„è¯­å¥å—ï¼Œå¹¶æŒ‡å®šåº”å¼•å‘å¼‚å¸¸çš„å“åº”

*/

const whereAmI = async function () {
  try {
    // Geolocation
    const pos = await getPosition();
    const { latitude: lat, longitude: lng } = pos.coords;

    // Reverse geocoding
    const resGeo = await fetch(`https://geocode.xyz/${lat},${lng}?geoit=json`);
    if (!resGeo.ok) throw new Error('Problem getting location data');
    const dataGeo = await resGeo.json();
    console.log(dataGeo.country);

    // Country data
    const res = await fetch(
      `https://restcountries.com/v3.1/name/${dataGeo.country}`
    );

    // BUG in video:
    // if (!resGeo.ok) throw new Error('Problem getting country');

    // FIX:
    if (!res.ok) throw new Error('Problem getting country');
    const data = await res.json();
    console.log(data[0]);
    renderCountry(data[0]);
  } catch (err) {
    console.error(`${err} ğŸ’¥`);
    renderError(`ğŸ’¥ ${err.message}`);
  }
};
whereAmI();
whereAmI();
whereAmI();
console.log('FIRST');
try {
  let y = 1;
  const x = 2;
  y = 3;
} catch (err) {
  alert(err.message);
}

/************** ä»å¼‚æ­¥å‡½æ•°è¿”å›å€¼(è¿”å›æ‰¿è¯º) */
/*
  1. å‡½æ•°è¿”å›çš„æ‰€æœ‰å†…å®¹æ˜¯ä¸€ä¸ªæ‰¿è¯ºã€‚ç°åœ¨æˆ‘ä»¬ä»å¼‚æ­¥å‡½æ•°è¿”å›çš„å€¼ï¼Œå†è¯´ä¸€æ¬¡ï¼Œè¿™æ˜¯è¿™é‡Œçš„å­—ç¬¦ä¸²å°†æˆä¸ºæ‰¿è¯ºçš„å®ç°ä»·å€¼ç”±å‡½æ•°è¿”å›ã€‚æ‰€ä»¥ç†è§£è¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚å†ä¸€æ¬¡ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°çš„è¿™ä¸ªæ‰¿è¯ºï¼Œè¯¥æ‰¿è¯ºçš„å®ç°ä»·å€¼å°†æ˜¯è¿™é‡Œçš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºé‚£æ˜¯æˆ‘ä»¬è¿”å›çš„å€¼ä»å¼‚æ­¥å‡½æ•°è€Œè‡³å°‘å¦‚æœè¿™é‡Œæ²¡æœ‰é”™è¯¯å‘ç”Ÿåœ¨å‡½æ•°ä¸­ï¼Œä½†ç°åœ¨ï¼Œè®©æˆ‘ä»¬å†æ¬¡å‡è®¾è¿™é‡Œçš„æˆåŠŸ
  2. (ä½†ç°åœ¨è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹é”™è¯¯ã€‚ å› æ­¤ï¼Œå¦‚æœæ­¤ try å—ä¸­å‡ºç°ä»»ä½•é”™è¯¯ï¼Œ é‚£ä¹ˆæ°¸è¿œä¸ä¼šåˆ°è¾¾è¿™é‡Œçš„è¿”å›) å› ä¸ºä»£ç ä¼šç«‹å³è·³è½¬ åˆ°äº† catch å—ï¼Œå¯¹å§ï¼Ÿ æ‰€ä»¥è®©æˆ‘ä»¬è¯•ç€åœ¨è¿™é‡Œåˆ›å»ºä¸€äº›é”™è¯¯ã€‚ æˆ‘å°±åœ¨è¿™é‡Œæ¢ä¸€ä¸ª æ‰€ä»¥ç°åœ¨ä»€ä¹ˆéƒ½è¡Œä¸é€šï¼Œ æ‰€ä»¥è®©æˆ‘ä»¬ç­‰å¾…å§
*/
// const whereAmI = async function () {
//   try {
//     // Geolocation
//     const pos = await getPosition();
//     const { latitude: lat, longitude: lng } = pos.coords;

//     // Reverse gecoding
//     const resGeo = await fetch(`https://geocode.xyz/${lat},${lng}?geoit=json`);
//     const dataGeo = await resGeo.json();
//     // console.log(resGeo);
//     // å‘ç”Ÿé”™è¯¯æ—¶, æ‰“å°errorå¯¹è±¡
//     /*
//       {success: false, error: {â€¦}}
//       error:
//       code: "006"
//       message: "Request Throttled. Over Rate limit: up to 0 per sec. See geocode.xyz/pricing"
//       requests: "2"
//       [[Prototype]]: Object
//       success: false
//       [[Prototype]]: Object
//     */
//     // console.log(dataGeo);
//     // Country data
//     const res = await fetch(
//       `https://restcountries.com/v3.1/name/${dataGeo.country}`
//     );
//     // console.log(res);

//     // BUG in video
//     if (!resGeo.ok) throw new Error('Problem getting location data');

//     // FIX:
//     if (!res.ok) throw new Error('Problem getting country');

//     const data = await res.json();

//     renderCountry(data[0]);
//     return `You are in ${dataGeo.city}, ${dataGeo.country}`;
//   } catch (err) {
//     console.error(`${err} ğŸ’¥`);
//     renderError(`ğŸ’¥ ${err.message}`);
//     // Reject promise returned from async function
//     throw err;
//   }
// };
// whereAmI();
// whereAmI();
// whereAmI();

// 1.
// console.log('1: Will get location');
// const city = whereAmI();
// console.log(city);
/* å¼‚æ­¥å‡½æ•°å§‹ç»ˆè¿”å›ä¸€ä¸ªå¼‚æ­¥å‡½æ•°
  PromiseÂ {<pending>}
  [[Prototype]]: Promise
  [[PromiseState]]: "fulfilled"
  [[PromiseResult]]: undefined

*/
// console.log('3: Finished getting location');

// 2.
// whereAmI()
//   .then(city => console.log(`2: ${city}`))
//   .catch(err => console.error(`2: ${err.message} ğŸ’¥`))
//   .finally(() => console.log('3: Finished getting location'));

// 3.
(async function () {
  try {
    const city = await whereAmI();
    console.log(`2: ${city}`);
  } catch (err) {
    console.log(`2: ${err.message} ğŸ’¥`);
  }
  console.log('3: Finished getting location');
})();

/************** å¹¶è¡Œè¿è¡ŒPromise.all */
/*
  1. Promiseæ˜¯æ„é€ å‡½æ•°, .callä¸€ç§è¾…åŠ©å‡½æ•°, æ˜¯é™æ€æ–¹æ³•æ¥å—ä¸€ç³»åˆ—æ‰¿è¯º, ç»„åˆå‡½æ•°ä¸ç»„åˆå™¨
  2. åŒä¸€æ—¶é—´å¤„ç†æ•°æ®, å¦‚æœå…¶ä¸­ä¸€ä¸ªæ‰¿è¯ºè¢«æ‹’ç», é‚£ä¹ˆæ•´ä¸ªPromise.allå®é™…ä¸Šä¹Ÿæ‹’ç»äº†, æ‰€ä»¥æˆ‘ä»¬è¯´Promise.allçŸ­è·¯
  3. .callåŒä¸€æ—¶é—´å¤„ç†æ•°æ®, æŒ‰ç…§å¼‚æ­¥å›è°ƒé¡ºåºæ˜¾ç¤ºæ•°æ®
*/

const get3Countries = async function (c1, c2, c3) {
  try {
    // æ—§æ–¹æ³•
    // const [data1] = await getJSON(`https://restcountries.com/v3/name/${c1}`);
    // const [data2] = await getJSON(`https://restcountries.com/v3/name/${c2}`);
    // const [data3] = await getJSON(`https://restcountries.com/v3/name/${c3}`);
    // console.log(data1.capital, data2.capital, data3.capital);
    // æ–°æ–¹æ³•
    const data = await Promise.all([
      getJSON(`https://restcountries.com/v3/name/${c1}`),
      getJSON(`https://restcountries.com/v3/name/${c2}`),
      getJSON(`https://restcountries.com/v3/name/${c3}`),
    ]);
    console.log(data);

    console.log(data.map(d => d[0].capital));
  } catch (err) {
    console.log(err);
  }
};

// get3Countries('portugal', 'canada', 'tanzania');

/************** Promise race*/
/*
  Promise race
    1. Promise race å…¶å®å¾ˆæœ‰ç”¨, é˜²æ­¢æ°¸æ— æ­¢å¢ƒçš„æ‰¿è¯º, æˆ–è€…æ˜¯éå¸¸é•¿æœŸçš„æ‰¿è¯º, ä¾‹å¦‚æœ‰ä¸€ä¸ªéå¸¸ç³Ÿç³•çš„äº’è”ç½‘è¿æ¥, ç„¶åå†ä½ çš„åº”ç”¨ç¨‹åºä¸­è·å–è¯·æ±‚, å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½çœŸæ­£æœ‰ç”¨
    2. æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„è¶…æ—¶æ‰¿è¯º, ç»è¿‡ä¸€æ®µæ—¶é—´è‡ªåŠ¨æ‹’ç»
    3. å¦‚æœç½‘å€æ˜¯é”™è¯¯çš„, æˆ‘ä»¬ä¸ä¼šæŠ¥é”™, ä¼šæ˜¾ç¤ºundefined
    4. ç»“æœè¿”å›æœ€å¿«å“åº”çš„APIæ•°æ®, å¦‚æœè¾“å…¥APIåœ°å€é”™è¯¯, é‚£ä¹ˆä¼šæ˜¾ç¤ºundefinedä¸ä¼šå½±å“ä½¿ç”¨
    5. æ–¹æ³•è¿”å›ä¸€ä¸ª promiseï¼Œä¸€æ—¦è¿­ä»£å™¨ä¸­çš„æŸä¸ªpromiseè§£å†³æˆ–æ‹’ç»ï¼Œè¿”å›çš„ promiseå°±ä¼šè§£å†³æˆ–æ‹’ç»ï¼Œåªæœ‰ä¸€ä¸ªæ‰¿è¯ºä¼šè¢«è§£å†³ï¼Œé‚£ä¸ªå¿«è¿”å›å“ªä¸ª(é‡ç‚¹)
*/
(async function () {
  try {
    const res = await Promise.race([
      getJSON(`https://restcountries.com/v2/name/italy`),
      getJSON(`https://restcountries.com/v2/name/egypt`),
      getJSON(`https://restcountries.com/v2/name/mexico`),
    ]);
    console.log(res[0]);
  } catch (err) {
    console.log(err);
  }
})();

// åˆ›å»ºä¸€ä¸ªç‰¹æ®Šè¶…æ—¶æ‰¿è¯º
// const timeout = function (sec) {
//   return new Promise(function (_, reject) {
//     setTimeout(function () {
//       reject(new Error('Request took too lang!'));
//     }, sec * 1000);
//   });
// };

// Promise.race([
//   getJSON(`https://restcountries.com/v3/name/tanzania`),
//   timeout(1),
// ])
//   .then(res => console.log(res[0]))
//   .catch(err => console.error(err));

/************** Promise allSettled*/
/*
  1. æ–¹æ³•è¿”å›ä¸€ä¸ªæ‰¿è¯ºï¼Œè¯¥æ‰¿è¯ºåœ¨æ‰€æœ‰ç»™å®šçš„æ‰¿è¯ºå·²å®Œæˆæˆ–è¢«æ‹’ç»åè§£æï¼Œå¹¶å¸¦æœ‰ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªå¯¹è±¡æè¿°æ¯ä¸ªæ‰¿è¯ºçš„ç»“æœ(é‡ç‚¹)
  2. ç±»ä¼¼äºPromise.all, è¿”å›æ‰€æœ‰ç»“æœæ•°ç»„, ä½†ä¸åŒçš„æ˜¯Promise.allæ‰¿è¯ºä¸€æ‹’ç»å°±ä¼šçŸ­è·¯, ä½†æ˜¯Promise.allSettledæ ¹æœ¬ä¸ä¼šçŸ­è·¯, å®ƒä¼šç®€å•åœ°è¿”å›æ‰€æœ‰æ‰¿è¯ºçš„æ‰€æœ‰ç»“æœ
*/
// Promise.allSettled([
//   Promise.resolve('Success'),
//   Promise.reject('ERROR'),
//   Promise.resolve('Another success'),
// ]).then(res => console.log(res));

// // å‘ç”ŸçŸ­è·¯, æŠ›å‡ºé”™è¯¯
// Promise.all([
//   Promise.resolve('Success'),
//   Promise.reject('ERROR'),
//   Promise.resolve('Another success'),
// ])
//   .then(res => console.log(res))
//   .catch(err => console.error(err));

/************** Promise any (ES2021)*/
/*
  1. æ¥æ”¶ä¸€ä¸ªPromiseå¯è¿­ä»£å¯¹è±¡, åªè¦å…¶ä¸­çš„ä¸€ä¸ªpromiseæˆåŠŸ, å°±è¿”å›é‚£ä¸ªå·²ç»æˆåŠŸçš„promise
  2. å¦‚æœå¯è¿­ä»£å¯¹è±¡ä¸­æ²¡æœ‰ä¸€ä¸ª promise æˆåŠŸ(å³æ‰€æœ‰çš„promiseséƒ½å¤±è´¥/æ‹’ç»), å°±è¿”å›ä¸€ä¸ªå¤±è´¥çš„promiseå’ŒAggregateErrorç±»å‹çš„å®ä¾‹, å®ƒæ˜¯Errorçš„ä¸€ä¸ªå­ç±», ç”¨äºæŠŠå•ä¸€çš„é”™è¯¯é›†åˆåœ¨ä¸€èµ· AggregateError: All promises were rejected
  3. æœ¬è´¨ä¸Šè¿™ä¸ªæ–¹æ³•å’ŒPromise.all()æ˜¯ç›¸åçš„
*/

// const test = function () {
//   return new Promise(function (resolve) {
//     setTimeout(resolve);
//   });
// };

// Promise.any([
//   Promise.reject('Success'),
//   Promise.reject('ERROR'),
//   Promise.reject('Another success'),
// ])
//   .then(res => console.log(res))
//   .catch(err => console.error(err));

/************** ç¼–ç æŒ‘æˆ˜ #3 */
/* 
PART 1
ç¼–å†™ä¸€ä¸ªå¼‚æ­¥å‡½æ•° 'loadNPause' æ¥é‡æ–°åˆ›å»º Coding Challenge #2ï¼Œè¿™æ¬¡ä½¿ç”¨ async/awaitï¼ˆä»…ä½¿ç”¨ Promise çš„éƒ¨åˆ†ï¼‰ã€‚ æ¯”è¾ƒä¸¤ä¸ªç‰ˆæœ¬ï¼Œæƒ³æƒ³æœ€å¤§çš„ä¸åŒï¼Œçœ‹çœ‹ä½ æ›´å–œæ¬¢å“ªä¸€ä¸ªã€‚
ä¸è¦å¿˜è®°æµ‹è¯•é”™è¯¯å¤„ç†ç¨‹åºï¼Œå¹¶åœ¨å¼€å‘å·¥å…·ç½‘ç»œé€‰é¡¹å¡ä¸­å°†ç½‘ç»œé€Ÿåº¦è®¾ç½®ä¸ºâ€œFast 3Gâ€ã€‚

PART 2
1. åˆ›å»ºä¸€ä¸ªå¼‚æ­¥å‡½æ•°â€œloadAllâ€ï¼Œå®ƒæ¥æ”¶ä¸€ç»„å›¾åƒè·¯å¾„â€œimgArrâ€ï¼›
2. ä½¿ç”¨ .map å¾ªç¯éå†æ•°ç»„ï¼Œä½¿ç”¨ 'createImage' å‡½æ•°åŠ è½½æ‰€æœ‰å›¾åƒï¼ˆè°ƒç”¨ç»“æœæ•°ç»„ 'imgs'ï¼‰
3.æŸ¥çœ‹æ§åˆ¶å°ä¸­çš„'imgs'æ•°ç»„ï¼ å’Œä½ é¢„æœŸçš„ä¸€æ ·å—ï¼Ÿ
4.ä½¿ç”¨promiseç»„åˆå™¨å‡½æ•°ä»æ•°ç»„ä¸­å®é™…è·å–å›¾åƒğŸ˜‰
5. å°†'parallell' ç±»æ·»åŠ åˆ°æ‰€æœ‰å›¾åƒï¼ˆå®ƒæœ‰ä¸€äº›CSS æ ·å¼ï¼‰ã€‚

TEST DATA: ['img/img-1.jpg', 'img/img-2.jpg', 'img/img-3.jpg']. To test, turn off the 'loadNPause' function.

GOOD LUCK ğŸ˜€
*/

/*
  1. å¼‚æ­¥å‡½æ•°å°†å§‹ç»ˆè¿”å›ä¸€ä¸ªæ‰¿è¯º
*/
// const wait = function (seconds) {
//   return new Promise(function (resolve) {
//     setTimeout(resolve, seconds * 1000);
//   });
// };

// const imgContainer = document.querySelector('.images');

// const createImage = function (imgPath) {
//   return new Promise(function (resolve, reject) {
//     const img = document.createElement('img');
//     img.src = imgPath;
//     img.addEventListener('load', function () {
//       imgContainer.append(img);
//       resolve(img);
//     });
//     img.addEventListener('error', function () {
//       reject(new Error('Image not found'));
//     });
//   });
// };

// let currentImg;

// createImage('img/img-1.jpg')
//   .then(img => {
//     currentImg = img;
//     console.log('Image 1 loaded');
//     return wait(1);
//   })
//   .then(() => {
//     currentImg.style.opacity = 0;
//     return createImage('img/img-2.jpg');
//   })
//   .then(img => {
//     currentImg = img;
//     console.log('Image 2 loaded');
//     return wait(1);
//   })
//   .then(() => {
//     currentImg.style.opacity = 0;
//   })
//   .catch(err => {
//     console.error(`${err}`);
//   });

// PART 1
// const loadNpause = async function () {
//   try {
//     // load image 1
//     let img = await createImage('img/img-1.jpg');
//     console.log('Image 1 loaded');
//     await wait(1);
//     img.style.opacity = 0;

//     img = await createImage('img/img-2.jpg');
//     console.log('Image 2 loaded');
//     await wait(1);
//     img.style.opacity = 0;
//   } catch (err) {
//     console.error(`${err}`);
//   }
// };
// loadNpause();

// PART 2
const loadAll = async function (imgArr) {
  try {
    /*
      1. å¼‚æ­¥å‡½æ•°å°†å§‹ç»ˆè¿”å›ä¸€ä¸ªæ‰¿è¯º
      2. async img(ä»£è¡¨è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°) => (ç®­å¤´ç›¸å½“äºreturn) await createImage(img)()
      3. async function(img) = { await createImage(img) }
      4.è¿™é‡Œæˆ‘ä»¬æƒ³è¦è¿”å›çš„å€¼å°†æˆä¸ºæ‰¿è¯ºçš„å®ç°ä»·å€¼, å¼‚æ­¥å‡½æ•°è¿”å›
    */
    const imgs = imgArr.map(async img => await createImage(img));
    console.log(imgs);
    const imgsEl = await Promise.all(imgs);
    console.log(imgsEl);
    imgsEl.forEach(img => img.classList.add('parallel'));
  } catch {
    console.error(`${err}`);
  }
};
loadAll(['img/img-1.jpg', 'img/img-2.jpg', 'img/img-3.jpg']);
